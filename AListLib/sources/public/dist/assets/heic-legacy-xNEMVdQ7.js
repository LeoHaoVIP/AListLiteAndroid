System.register(["./index-legacy-DGSy0swL.js"],function(e,t){"use strict";var i,n,r,a,o,c,s,h,l,f,d,w,u,g,y,m;return{setters:[e=>{i=e.j,n=e.B,r=e.e6,a=e.a5,o=e.av,c=e.O,s=e.ay,h=e.a_,l=e.D,f=e.ad,d=e.S,w=e.ab,u=e.o,g=e.cp,y=e.ee,m=e.ef}],execute:function(){var t=s("<div id=heic-container style=position:relative;width:100%;height:75vh;display:flex;justify-content:center;align-items:center;overflow:hidden><canvas style=max-width:100%;max-height:100%;object-fit:contain>");e("default",()=>{const e=u();i();const[s,v]=n(!0),[p,b]=n(!1),{libHeifPath:j}=r();let x,_,C,$=a.objs.filter(e=>/\.(heic|heif|avif|vvc|avc|jpeg|jpg)$/i.test(e.name));0===$.length&&($=[a.obj]),o(()=>{B()}),c(()=>{x&&_&&(_=null),x=null});const B=async()=>{v(!0),b(!1);try{window.libheif||await D(`${j()}/libheif.js`,"libheif-script");const e=await H(`${j()}/libheif.wasm`);x=window.libheif({wasmBinary:e}),_=new x.HeifDecoder,await I(a.raw_url)}catch(e){console.error("HEIC初始化失败:",e),b(!0),v(!1)}},D=(e,t)=>new Promise((i,n)=>{const r=document.createElement("script");r.src=e,r.id=t,r.onload=()=>i(),r.onerror=()=>n(`脚本加载失败: ${e}`),document.head.appendChild(r)}),H=async e=>{const t=await fetch(e);if(!t.ok)throw`WASM加载失败: ${e}`;return await t.arrayBuffer()},I=async e=>{try{v(!0),b(!1);const t=await fetch(e);if(!t.ok)throw"文件获取失败";const i=await t.arrayBuffer(),n=_.decode(i);if(!n||0===n.length)throw"没有可解码的图像";const r=n[0];await k(r),v(!1)}catch(t){console.error("HEIC解码失败:",t),b(!0),v(!1)}},k=e=>new Promise(t=>{if(!C)return t();const i=e.get_width(),n=e.get_height();C.width=i,C.height=n;const r=new ImageData(i,n);e.display(r,e=>{if(!e||!C)return t();const i=C.getContext("2d");if(!i)return t();i.putImageData(e,0,0),t()})});return E=t(),P=E.firstChild,"function"==typeof C?m(C,P):C=P,h(E,l(d,{get when(){return s()},get children(){return l(f,{})}}),null),h(E,l(d,{get when(){return p()},get children(){return l(w,{get msg(){return e("preview.failed_load_heic")},h:"75vh"})}}),null),g(e=>y(P,"display",s()||p()?"none":"block")),E;var E,P})}}});
