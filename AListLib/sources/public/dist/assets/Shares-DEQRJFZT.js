import{bU as C,D as r,dw as i,S as _,ax as f,ay as o,ae as v,o as w,au as x,K as u,bX as L,dt as k,cz as O,V as $,j as y,b9 as b,bq as S,bb as B,bt as D,r as R,B as U,aW as I,al as F,dr as H,ds as M,R as m,du as g,dv as P,af as V}from"./index-C2tuPJaA.js";import{b as W}from"./useTitle-BxtUm_0q.js";import{m as X}from"./share-DNtGrOny.js";import{D as j}from"./DeletePopover-GJ24w0i7.js";function q(e){const t=w(),{to:c}=y(),[l,h]=b(()=>S.post("/share/delete?id=".concat(e.share.id))),[d,a]=b(()=>S.post("/share/".concat(e.share.disabled?"enable":"disable","?id=").concat(e.share.id)));return[r(u,{get disabled(){return!e.canShare},onClick:()=>{c("/@manage/shares/edit/".concat(e.share.id))},get children(){return t("global.edit")}}),r(u,{get loading(){return d()},get colorScheme(){return e.share.disabled?"success":"warning"},onClick:async()=>{const s=await a();B(s,()=>{e.refresh()})},get children(){return t("global.".concat(e.share.disabled?"enable":"disable"))}}),r(j,{get name(){return e.share.id},get loading(){return l()},onClick:async()=>{const s=await h();D(s,()=>{R.success(t("global.delete_success")),e.refresh()})}})]}const z=e=>{if(e.role<0)return null;const t=["info","neutral","accent"];return r(O,{get colorScheme(){return t[e.role]},css:{overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis"},get children(){return e.name}})};function K(e){const t=w(),c=()=>{if(e.share.files.length===0)return"";let a=e.share.files[0];return e.share.files.length>1&&(a+=t("shares.files_etc",{more:e.share.files.length-1})),a},l=()=>e.share.max_accessed>0?"".concat(e.share.accessed," / ").concat(e.share.max_accessed):"".concat(e.share.accessed),h=()=>e.share.disabled?"disabled":e.share.max_accessed>0&&e.share.accessed>=e.share.max_accessed||e.share.files.length===0||e.share.expires&&new Date(e.share.expires)<new Date?"invalid":e.share.creator===o().username&&!e.canShare?"denied":"work",{copy:d}=C();return r(k,{get children(){return[r(i,{get children(){return c()}}),r(i,{get children(){return e.share.id}}),r(_,{get when(){return f.is_admin(o())},get children(){return r(i,{get children(){return r(z,{get name(){return e.share.creator},get role(){return e.share.creator_role}})}})}}),r(i,{get children(){return v(()=>!!e.share.expires)()?new Date(e.share.expires).toLocaleString():""}}),r(i,{get children(){return l()}}),r(i,{get children(){return t("shares.status_list.".concat(h()))}}),r(i,{get children(){return e.share.remark}}),r(i,{get children(){return r(x,{spacing:"$2",get children(){return[r(u,{colorScheme:"primary",onClick:()=>{const a=X(e.share,{site_title:$("site_title")}),s=L($("share_summary_content"),a);d(s)},get children(){return t("shares.copy_msg")}}),r(q,e)]}})}})]}})}const J=()=>{const e=w();W("manage.sidemenu.shares");const{to:t}=y(),[c,l]=b(()=>S.get("/share/list")),[h,d]=U([]),a=async()=>{const n=await l();D(n,T=>d(T.content))},s=f.can(o(),I.findIndex(n=>n==="share"));return a(),r(V,{spacing:"$3",alignItems:"start",w:"$full",get children(){return[r(x,{spacing:"$2",gap:"$2",w:"$full",wrap:{"@initial":"wrap","@md":"unset"},get children(){return[r(u,{colorScheme:"accent",get loading(){return c()},onClick:a,get children(){return e("global.refresh")}}),r(u,{disabled:!s,onClick:()=>{t("/@manage/shares/add")},get children(){return e("global.add")}})]}}),r(F,{w:"$full",overflowX:"auto",get children(){return r(H,{highlightOnHover:!0,dense:!0,get children(){return[r(M,{get children(){return r(k,{get children(){return[r(m,{each:["files","id"],children:n=>r(g,{get children(){return e("shares.".concat(n))}})}),r(_,{get when(){return f.is_admin(o())},get children(){return r(g,{get children(){return e("shares.creator")}})}}),r(m,{each:["expires","accessed","status","remark"],children:n=>r(g,{get children(){return e("shares.".concat(n))}})}),r(g,{get children(){return e("global.operations")}})]}})}}),r(P,{get children(){return r(m,{get each(){return h()},children:n=>r(K,{share:n,refresh:a,canShare:s})})}})]}})}})]}})};export{J as default};
