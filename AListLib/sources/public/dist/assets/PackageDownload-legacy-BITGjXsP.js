System.register(["./index-legacy-D2rKgweC.js"],function(e,t){"use strict";var r,n,a,o,s,i,l,c,d,m,u,h,p,g,w,f,v,y,b,S;return{setters:[e=>{r=e.cN,n=e.B,a=e.o,o=e.j,s=e.k,i=e.D,l=e.ai,c=e.c1,d=e.ac,m=e.U,u=e.ah,h=e.G,p=e.J,g=e.K,w=e.S,f=e.l,v=e.y,y=e.z,b=e.A,S=e._}],execute:function(){class t{constructor(){this.crc=-1}append(e){for(var t=0|this.crc,r=this.table,n=0,a=0|e.length;n<a;n++)t=t>>>8^r[255&(t^e[n])];this.crc=t}get(){return~this.crc}}t.prototype.table=(()=>{var e,t,r,n=[];for(e=0;e<256;e++){for(r=e,t=0;t<8;t++)r=1&r?r>>>1^3988292384:r>>>1;n[e]=r}return n})();const U=e=>{var t=new Uint8Array(e);return{array:t,view:new DataView(t.buffer)}};window.ZIP=function(e){const r=Object.create(null),n=[],a=new TextEncoder;let o,s,i,l=0,c=0;function d(){c++,s=r[n[c]],s?h():i&&u()}var m={enqueue(e){if(i)throw new TypeError("Cannot enqueue a chunk into a readable stream that is closed or has been requested to be closed");let t=e.name.trim();const c=new Date(void 0===e.lastModified?Date.now():e.lastModified);if(e.directory&&!t.endsWith("/")&&(t+="/"),r[t])throw new Error("File already exists.");const m=a.encode(t);n.push(t);const u=r[t]={level:0,ctrl:o,directory:!!e.directory,nameBuf:m,comment:a.encode(e.comment||""),compressedLength:0,uncompressedLength:0,writeHeader(){var e=U(26),t=U(30+m.length);u.offset=l,u.header=e,0===u.level||u.directory||e.view.setUint16(4,2048),e.view.setUint32(0,335546376),e.view.setUint16(6,(c.getHours()<<6|c.getMinutes())<<5|c.getSeconds()/2,!0),e.view.setUint16(8,(c.getFullYear()-1980<<4|c.getMonth()+1)<<5|c.getDate(),!0),e.view.setUint16(22,m.length,!0),t.view.setUint32(0,1347093252),t.array.set(e.array,4),t.array.set(m,30),l+=t.array.length,o.enqueue(t.array)},writeFooter(){var e=U(16);e.view.setUint32(0,1347094280),u.crc&&(u.header.view.setUint32(10,u.crc.get(),!0),u.header.view.setUint32(14,u.compressedLength,!0),u.header.view.setUint32(18,u.uncompressedLength,!0),e.view.setUint32(4,u.crc.get(),!0),e.view.setUint32(8,u.compressedLength,!0),e.view.setUint32(12,u.uncompressedLength,!0)),o.enqueue(e.array),l+=u.compressedLength+16,d()},fileLike:e};s||(s=u,h())},close(){if(i)throw new TypeError("Cannot close a readable stream that has already been requested to be closed");s||u(),i=!0}};function u(){var e,t,a=0,s=0;for(e=0;e<n.length;e++)a+=46+(t=r[n[e]]).nameBuf.length+t.comment.length;const i=U(a+22);for(e=0;e<n.length;e++)t=r[n[e]],i.view.setUint32(s,1347092738),i.view.setUint16(s+4,5120),i.array.set(t.header.array,s+6),i.view.setUint16(s+32,t.comment.length,!0),t.directory&&i.view.setUint8(s+38,16),i.view.setUint32(s+42,t.offset,!0),i.array.set(t.nameBuf,s+46),i.array.set(t.comment,s+46+t.nameBuf.length),s+=46+t.nameBuf.length+t.comment.length;i.view.setUint32(s,1347093766),i.view.setUint16(s+8,n.length,!0),i.view.setUint16(s+10,n.length,!0),i.view.setUint32(s+12,a,!0),i.view.setUint32(s+16,l,!0),o.enqueue(i.array),o.close()}function h(){var e;if(s)return s.directory?s.writeFooter(s.writeHeader()):s.reader?(e=s).reader.read().then(t=>{if(t.done)return e.writeFooter();const r=t.value;e.crc.append(r),e.uncompressedLength+=r.length,e.compressedLength+=r.length,e.ctrl.enqueue(r)}):void(s.fileLike.stream?(s.crc=new t,s.reader=s.fileLike.stream.getReader(),s.writeHeader()):d())}return new ReadableStream({start:t=>{o=t,e.start&&Promise.resolve(e.start(m))},pull:()=>h()||e.pull&&Promise.resolve(e.pull(m))})};var L,E={exports:{}},M=(L||(L=1,function(e){var t;t=()=>{const e="object"==typeof window?window:this;e.HTMLElement||console.warn("streamsaver is meant to run on browsers main thread");let t=null,r=!1;const n=e.WebStreamsPolyfill||{},a=e.isSecureContext;let o=/constructor/i.test(e.HTMLElement)||!!e.safari||!!e.WebKitPoint;const s=a||"MozAppearance"in document.documentElement.style?"iframe":"navigate",i={createWriteStream:function(n,c,d){let m={size:null,pathname:null,writableStrategy:void 0,readableStrategy:void 0},u=0,h=null,p=null,g=null;if(Number.isFinite(c)?([d,c]=[c,d],console.warn("[StreamSaver] Deprecated pass an object as 2nd argument when creating a write stream"),m.size=d,m.writableStrategy=c):c&&c.highWaterMark?(console.warn("[StreamSaver] Deprecated pass an object as 2nd argument when creating a write stream"),m.size=d,m.writableStrategy=c):m=c||{},!o){t||(t=a?l(i.mitm):function(t){const r="width=200,height=100",n=document.createDocumentFragment(),a={frame:e.open(t,"popup",r),loaded:!1,isIframe:!1,isPopup:!0,remove(){a.frame.close()},addEventListener(...e){n.addEventListener(...e)},dispatchEvent(...e){n.dispatchEvent(...e)},removeEventListener(...e){n.removeEventListener(...e)},postMessage(...e){a.frame.postMessage(...e)}},o=t=>{t.source===a.frame&&(a.loaded=!0,e.removeEventListener("message",o),a.dispatchEvent(new Event("load")))};return e.addEventListener("message",o),a}(i.mitm)),p=new MessageChannel,n=encodeURIComponent(n.replace(/\//g,":")).replace(/['()]/g,escape).replace(/\*/g,"%2A");const o={transferringReadable:r,pathname:m.pathname||Math.random().toString().slice(-6)+"/"+n,headers:{"Content-Type":"application/octet-stream; charset=utf-8","Content-Disposition":"attachment; filename*=UTF-8''"+n}};m.size&&(o.headers["Content-Length"]=m.size);const c=[o,"*",[p.port2]];if(r){const e="iframe"===s?void 0:{transform(e,t){if(!(e instanceof Uint8Array))throw new TypeError("Can only write Uint8Arrays");u+=e.length,t.enqueue(e),h&&(location.href=h,h=null)},flush(){h&&(location.href=h)}};g=new i.TransformStream(e,m.writableStrategy,m.readableStrategy);const t=g.readable;p.port1.postMessage({readableStream:t},[t])}p.port1.onmessage=e=>{e.data.download?"navigate"===s?(t.remove(),t=null,u?location.href=e.data.download:h=e.data.download):(t.isPopup&&(t.remove(),t=null,"iframe"===s&&l(i.mitm)),l(e.data.download)):e.data.abort&&(w=[],p.port1.postMessage("abort"),p.port1.onmessage=null,p.port1.close(),p.port2.close(),p=null)},t.loaded?t.postMessage(...c):t.addEventListener("load",()=>{t.postMessage(...c)},{once:!0})}let w=[];return!o&&g&&g.writable||new i.WritableStream({write(e){if(!(e instanceof Uint8Array))throw new TypeError("Can only write Uint8Arrays");o?w.push(e):(p.port1.postMessage(e),u+=e.length,h&&(location.href=h,h=null))},close(){if(o){const e=new Blob(w,{type:"application/octet-stream; charset=utf-8"}),t=document.createElement("a");t.href=URL.createObjectURL(e),t.download=n,t.click()}else p.port1.postMessage("end")},abort(){w=[],p.port1.postMessage("abort"),p.port1.onmessage=null,p.port1.close(),p.port2.close(),p=null}},m.writableStrategy)},WritableStream:e.WritableStream||n.WritableStream,supported:!0,version:{full:"2.0.5",major:2,minor:0,dot:5},mitm:"https://jimmywarting.github.io/StreamSaver.js/mitm.html?version=2.0.0"};function l(e){if(!e)throw new Error("meh");const t=document.createElement("iframe");return t.hidden=!0,t.src=e,t.loaded=!1,t.name="iframe",t.isIframe=!0,t.postMessage=(...e)=>t.contentWindow.postMessage(...e),t.addEventListener("load",()=>{t.loaded=!0},{once:!0}),document.body.appendChild(t),t}try{new Response(new ReadableStream),a&&!("serviceWorker"in navigator)&&(o=!0)}catch(c){o=!0}return(e=>{try{e()}catch(t){}})(()=>{const{readable:e}=new TransformStream,t=new MessageChannel;t.port1.postMessage(e,[e]),t.port1.close(),t.port2.close(),r=!0,Object.defineProperty(i,"TransformStream",{configurable:!1,writable:!1,value:TransformStream})}),i},e.exports=t()}(E)),E.exports);/*! streamsaver. MIT License. Jimmy WÃ¤rting <https://jimmy.warting.se/opensource> */const k=r(M);k.mitm="/streamer/mitm.html";let T=0;e("default",e=>{const t=a(),[r,U]=n(t("home.package_download.initializing")),[L,E]=n(0),{pathname:M,isShare:C}=o(),W=s(),_=async(e,t)=>{if(t.is_dir){const r=await b(y(M(),e,t.name),S());if(200!==r.code)return r.message;const n=[];for(const a of r.data.content??[]){const r=await _(y(e,t.name),a);if("string"==typeof r)return r;n.push(...r)}return n}return T+=t.size,[{path:y(e,t.name),url:v(y(M(),e),t,"direct",C(),!0)}]},[j,z]=n([]);return(async()=>{let e=f(M());1===W.length&&(e=W[0].name),e||(e=t("manage.sidemenu.home"));let r=k.createWriteStream(`${e}.zip`,{size:T});U(t("home.package_download.fetching_struct")),E(2);const n=[];for(const s of W){const e=await _("",s);if("string"==typeof e)return U(`${t("home.package_download.fetching_struct_failed")}: ${e}`),E(1),e;n.push(...e)}U(t("home.package_download.downloading")),E(3);let a=n.values(),o=new window.ZIP({pull(t){const r=a.next();if(!r.done){let n=r.value.path.replace(/^\/+|\/+$/g,"");1===W.length&&(n=n.replace(`${e}/`,""));const a=r.value.url;return fetch(a).then(e=>{z(e=>[...e,n]),t.enqueue({name:n,stream:e.body})})}t.close()}});window.WritableStream&&o.pipeTo&&o.pipeTo(r).then(()=>{U(`${t("home.package_download.success")}`),E(4)}).catch(e=>{U(`${t("home.package_download.failed")}: ${e}`),E(1)})})(),[i(h,{get children(){return i(l,{w:"$full",alignItems:"start",spacing:"$2",get children(){return[i(c,{get children(){return[d(()=>t("home.package_download.current_status")),": ",d(()=>r())]}}),i(m,{get each(){return j()},children:e=>i(u,{css:{wordBreak:"break-all"},get children(){return["Fetching: ",e]}})})]}})}}),i(w,{get when(){return[1,4].includes(L())},get children(){return i(p,{get children(){return i(g,{colorScheme:"info",get onClick(){return e.onClose},get children(){return t("global.close")}})}})}})]})}}});
