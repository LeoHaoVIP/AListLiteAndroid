import{k as fe,an as Oe,bb as ue,eh as Pe,ei as Me,Q as y,C as c,D as de,a6 as k,P as Ie,ej as b,E as t,a3 as Le,Y as R,Z as W,ad as q,V as ge,a2 as he,S as m,aa as Fe,ab as z,ac as Ee,ai as v,q as we,aj as T,a9 as Ue,aK as Ae,ae as me,ay as S,bu as Be,aq as Re,ds as We,ek as qe,bV as p,aO as be,aG as ze,r as Te,cF as De,cR as Ve,a1 as Ne,ax as Ge,bW as Ye,cI as He,aS as Je,aY as Ke,a7 as Qe,a8 as Ze,_ as D,aV as Xe}from"./index-BFcje_PK.js";import{O as et,g as tt}from"./icon-GBF7AwS-.js";import{L as rt,c as _}from"./List-DOD55AgZ.js";import{d as nt,g as at}from"./index-CujSWyj5.js";import{g as it,O as st}from"./File-CzSir5-J.js";import lt from"./Password-v7DJypDI.js";import{u as ot}from"./helper-BbREDs7J.js";import{b as ct,x as V,w as ut}from"./style-C-fe3_ER.js";import"./Layout-B7gk9ufY.js";import"./useTitle-D5uVo66S.js";import"./FolderTree-Za4fY-tT.js";import"./index-DQFO1fUw.js";import"./index-CC_EEPDO.js";import"./share-BynbuRzK.js";import"./index-CrmJXdfg.js";import"./storage-BWbNxF5o.js";function dt(){let a=!1,s=[];return{acquire:()=>new Promise(u=>{a?s.push(u):(a=!0,u())}),release:()=>{s.length>0?s.shift()():a=!1}}}const gt=a=>{window.open(a,"_blank")},ht=a=>{const{show:s}=ct({id:2}),{isMouseSupported:u}=ot(),i=()=>Te.list_item_filename_overflow;return t(Ge.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.2},style:{width:"100%"},get children(){return t(S,{class:"list-item viselect-item",get"data-index"(){return a.index},w:"$full",p:"$2",rounded:"$lg",transition:"all 0.3s",get _hover(){return{transform:"scale(1.01)",bgColor:Ne()}},get cursor(){return u()?"default":"pointer"},"on:click":f=>{a.obj.is_dir?a.jumpCallback():!a.obj.is_dir&&a.onFileClick&&a.onFileClick()},onContextMenu:f=>{s(f,{props:a})},get children(){return[t(S,{class:"name-box",spacing:"$1",get w(){return _[0].w},get children(){return[t(be,{class:"icon",boxSize:"$6",get color(){return ze()},get as(){return tt(a.obj)},mr:"$1"}),t(v,{class:"name",get css(){return{wordBreak:"break-all",whiteSpace:i()==="multi_line"?"unset":"nowrap","overflow-x":i()==="scrollable"?"auto":"hidden",textOverflow:i()==="ellipsis"?"ellipsis":"unset","scrollbar-width":"none","&::-webkit-scrollbar":{display:"none"}}},get title(){return a.obj.name},get children(){return a.obj.name}})]}}),t(v,{class:"size",get w(){return _[1].w},get textAlign(){return _[1].textAlign},get children(){return De(a.obj.size)}}),t(v,{class:"modified",display:{"@initial":"none","@md":"inline"},get w(){return _[2].w},get textAlign(){return _[2].textAlign},get children(){return Ve(a.obj.modified)}})]}})}})},N={extract:{icon:at,color:"$success9"},copy_link:{icon:nt,color:"$info9"},download:{icon:Xe,color:"$primary9"}},mt=()=>{const{copy:a}=Ye(),{colorMode:s}=He(),{isShare:u}=fe();return t(ut,{id:2,animation:"scale",get theme(){return s()!=="dark"?"light":"dark"},style:"z-index: var(--hope-zIndices-popover)",get children(){return[t(V,{hidden:({props:i})=>i.obj.is_dir,onClick:({props:i})=>{gt(i.url)},get children(){return t(G,{name:"download"})}}),t(V,{hidden:({props:i})=>i.obj.is_dir,onClick:({props:i})=>{a(i.url)},get children(){return t(G,{name:"copy_link"})}}),t(V,{hidden:()=>{const i=Ke.findIndex(f=>f==="decompress");return!u()&&!Qe.can(Ze(),i)},onClick:({props:i})=>{Je.emit("extract",JSON.stringify({inner:i.innerPath,pass:i.pass}))},get children(){return t(G,{name:"extract"})}})]}})},G=a=>{const s=we();return t(S,{spacing:"$2",get children(){return[t(be,{get p(){return N[a.name].p?"$1":void 0},get as(){return N[a.name].icon},boxSize:"$7",get color(){return N[a.name].color}}),t(v,{get children(){return s("home.toolbar.".concat(a.name))}})]}})},It=()=>{const a=we(),{pathname:s}=fe(),{rawLink:u}=Oe(),[i,f]=ue(Pe),[pe,Y]=ue(Me),ve=y(()=>i()||pe());let d="",H="",J="",x=null;const[O,j]=c(""),[ke,K]=c(!1),[P,M]=c(!1),[Q,_e]=c(""),[o,I]=c([]),[L,Z]=c(),[xe,X]=c(!1),[je,ee]=c(""),[g,te]=c(""),[re,ne]=c(""),h=dt(),$=e=>{let n={};return e.forEach(r=>{n[r.name]={...r,children:r.children?$(r.children):null}}),n},F=e=>e.code===200?!1:(e.code===202?p(()=>{d!==""&&K(!0),M(!0),j("")}):j(e.message),!0),ae=async e=>{if(await h.acquire(),P()&&d==="")return h.release(),[];if(H===""){const r=await f(s(),D(),d);if(F(r))return h.release(),[];if(r.data.content!==null&&(x=$(r.data.content)),H=r.data.raw_url,J=r.data.sign,_e(r.data.comment),r.data.sort!==void 0){let l;r.data.sort.order_by!==""&&(l=r.data.sort.order_by);let w=r.data.sort.order_direction==="desc",Se=r.data.sort.extract_folder;p(()=>{Z(l),X(w),ee(Se)})}if(r.data.encrypted&&d==="")return p(()=>{M(!0),j("")}),h.release(),[]}if(x===null){const r=await Y(s(),D(),d,"/");if(F(r))return h.release(),[];x=$(r.data.content)}let n=x;for(let r=0;r<e.length;r++){if(n[e[r]].children===null){const l=await Y(s(),D(),d,"/"+e.slice(0,r+1).join("/"));if(F(l))return h.release(),[];n[e[r]].children=$(l.data.content)}n=n[e[r]].children}return p(()=>{M(!1),K(!1),j("")}),h.release(),Object.values(n)},[$e,ie]=c([]);de(()=>{ae(o()).then(e=>ie(e))});const se=()=>{ae(o()).then(e=>ie(e))};se();const le=()=>{let e=$e();L()&&(e=e.sort((r,l)=>(xe()?-1:1)*qe(r[L()],l[L()])));let n=je();if(n!==""){let r=[],l=[];e.forEach(w=>(w.is_dir?r:l).push(w)),e=n==="front"?r.concat(l):l.concat(r)}return e},Ce=e=>(o().length>0?"/"+o().join("/"):"")+"/"+e,oe=e=>{const n=o().length>0?"/"+o().join("/"):"";return{...e,sign:J,inner_path:n,archive:B}},ye=(e,n)=>{p(()=>{ee(""),Z(e),n!==void 0&&X(n)})},E=y(()=>le().filter(e=>!e.is_dir).map(e=>oe(e))),U=y(()=>{const e=E().find(n=>n.name===g());return e?it({...e,provider:k.provider}):[]}),A=y(()=>{const e=U();if(e.length===0)return null;if(re()){const n=e.find(r=>r.name===re());if(n)return n}return e[0]}),B={...k.obj,inner_path:void 0,archive:void 0},ce=k.raw_url,C=e=>{p(()=>{if(e==="")b.setObj(B),b.setRawUrl(ce),te("");else{const n=E().find(r=>r.name===e);if(n){const r=u(n);b.setObj(n),b.setRawUrl(r),te(e)}}})};return Ie(()=>{b.setObj(B),b.setRawUrl(ce)}),de(()=>{g(),ne("")}),t(T,{spacing:"$2",w:"$full",get children(){return[t(Le,{pl:"$2",pr:"$2",w:"$full",get children(){return[t(R,{get children(){return t(W,{get currentPage(){return q(()=>o().length===0)()&&!g()},"on:click":()=>{I([]),C("")},children:"."})}}),t(ge,{get each(){return o()},children:(e,n)=>t(R,{get children(){return[t(he,{}),t(W,{get currentPage(){return q(()=>o().length===n()+1)()&&!g()},"on:click":()=>{I(o().slice(0,n()+1)),C("")},children:e})]}})}),t(m,{get when(){return g()},get children(){return t(R,{get children(){return[t(he,{}),t(W,{currentPage:!0,get children(){return g()}})]}})}})]}}),t(Fe,{get children(){return[t(z,{get when(){return O()!==""},get children(){return t(Ee,{get msg(){return O()},disableColor:!0})}}),t(z,{get when(){return P()},get children(){return t(lt,{get title(){return a("home.toolbar.archive.input_password")},password:()=>d,setPassword:e=>d=e,enterCallback:()=>se(),get children(){return t(m,{get when(){return ke()},get children(){return t(v,{color:"$danger9",get children(){return a("home.toolbar.archive.incorrect_password")}})}})}})}}),t(z,{get when(){return q(()=>!P())()&&O()===""},get children(){return t(m,{get when(){return g()},get fallback(){return t(Re,{get loading(){return ve()},get children(){return t(T,{class:"list",w:"$full",spacing:"$1",get children(){return[t(rt,{sortCallback:ye,disableCheckbox:!0}),t(ge,{get each(){return le()},children:(e,n)=>{const r=oe(e);let l=e.is_dir?void 0:u(r),w=Ce(e.name);return t(ht,{obj:e,get index(){return n()},jumpCallback:()=>I(o().concat(e.name)),innerPath:w,url:l,pass:d,onFileClick:()=>C(e.name)})}}),t(mt,{})]}})}})},get children(){return t(m,{get when(){return g()},get fallback(){return t(me,{})},get children(){return t(T,{w:"$full",spacing:"$2",alignItems:"center",get children(){return[t(m,{get when(){return A()},get children(){return t(Ue,{get fallback(){return t(me,{})},get children(){return t(Ae,{get component(){var e;return(e=A())==null?void 0:e.component},get images(){return E().filter(e=>e.type===et.IMAGE)},navigate:e=>{C(e)}})}})}}),t(S,{w:"$full",justifyContent:"center",spacing:"$2",p:"$2",get children(){return[t(m,{get when(){return U().length>1},get children(){return t(Be,{get value(){var e;return((e=A())==null?void 0:e.name)||""},onChange:e=>ne(String(e)),get options(){return U().map(e=>({value:e.name,label:e.name}))}})}}),t(st,{get file(){return{name:g(),raw_url:k.raw_url,d_url:k.raw_url}}})]}})]}})}})}})}})]}}),t(m,{get when(){return Q()!==""},get children(){return[t(We,{}),t(v,{w:"$full",pl:"$1",pr:"$1",get children(){return Q()}})]}})]}})};export{It as default};
