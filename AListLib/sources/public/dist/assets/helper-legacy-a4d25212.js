System.register(["./index-legacy-1f04bc87.js","./Paginator-legacy-4f14dee7.js"],(function(e,t){"use strict";var r,n,a,l,s,o,c,i,d,g,u,h,p,m,w,$,k,f,x,y,v,_,b,S,z,A,C,T,F,P,B,R,I,D,L,O,j,E,G;return{setters:[e=>{r=e.ar,n=e.b,a=e.b3,l=e.bk,s=e.q,o=e.y,c=e.ao,i=e.b5,d=e.bR,g=e.S,u=e.aL,h=e.cs,p=e.ct,m=e.a9,w=e.bS,$=e.db,k=e.D,f=e.bl,x=e.n,y=e.ae,v=e.aa,_=e.dc,b=e.dd,S=e.K,z=e.de,A=e.cq,C=e.G,T=e.x,F=e.r,P=e.I,B=e.J,R=e.bN,I=e.df,D=e.aT,L=e.cd,O=e.dg,j=e.ce,E=e.as},e=>{G=e.P}],execute:function(){const t={7:"danger",2:"success",4:"neutral"},W=e=>{if(e.role<0)return null;const t=["info","neutral","accent"];return o(A,{get colorScheme(){return t[e.role]},css:{overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis"},get children(){return e.name}})},q=e=>{const r=n();return o(A,{get colorScheme(){return t[e.state]??"info"},get children(){return r(`tasks.state.${e.state}`)}})},K=[{name:"name",textAlign:"left",w:2===r().role?"calc(100% - 660px)":"calc(100% - 560px)"},{name:"creator",textAlign:"center",w:2===r().role?"100px":"0"},{name:"state",textAlign:"center",w:"100px"},{name:"progress",textAlign:"left",w:"140px"},{name:"speed",textAlign:"center",w:"100px"},{name:"operation",textAlign:"right",w:"220px"}],M=e=>Math.floor(e).toString().padStart(2,"0"),J=e=>{const t=n(),A="undone"===e.done?"cancel":"delete",C="done"===e.done&&(7===e.state||4===e.state),[T,F]=a((()=>l.post(`/task/${e.type}/${A}?tid=${e.id}`))),[P,B]=a((()=>l.post(`/task/${e.type}/retry?tid=${e.id}`))),[R,I]=s(!1),D=e.name.match(e.nameAnalyzer.regex),L=null===D?e.name:e.nameAnalyzer.title(D),O=null===e.start_time?-1:new Date(e.start_time).getTime(),j=null===e.end_time?(new Date).getTime():new Date(e.end_time).getTime();let E="-";const G=(e,t)=>{let r=t/e,n="bytes/s";return r>1024&&(r/=1024,n="KB/s"),r>1024&&(r/=1024,n="MB/s"),r>1024&&(r/=1024,n="GB/s"),`${r.toFixed(2)} ${n}`};if(e.done){if(e.start_time!==e.end_time&&e.progress>0&&-1!==O){const t=(j-O)/1e3,r=e.total_bytes*e.progress/100;E=G(t,r)}}else if(void 0!==e.prevProgress&&void 0!==e.prevFetchTime){const t=(e.curFetchTime-e.prevFetchTime)/1e3,r=(e.progress-e.prevProgress)*e.total_bytes/100;E=G(t,r)}return o(g,{get when(){return!R()},get children(){return[o(c,{w:"$full",p:"$2",get children(){return[o(c,{get w(){return K[0].w},spacing:"$1",get children(){return[o(i,{"on:click":e=>{e.stopPropagation()},get checked(){return e.local.selected},onChange:t=>{e.setLocal({selected:t.target.checked,expanded:e.local.expanded})}}),o(d,{size:"sm",css:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:L})]}}),o(g,{get when(){return 2===r().role},get children(){return o(u,{get w(){return K[1].w},get children(){return o(W,{get name(){return e.creator},get role(){return e.creator_role}})}})}}),o(u,{get w(){return K[2].w},get children(){return o(q,{get state(){return e.state}})}}),o(h,{get w(){return K[3].w},trackColor:"$info3",rounded:"$full",size:"sm",get value(){return e.progress},mr:"$1",get children(){return o(p,{color:"$info8",rounded:"$md"})}}),o(u,{get w(){return K[1].w},get children(){return o(m,{size:"sm",css:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:E})}}),o(w,{get w(){return K[5].w},gap:"$1",get children(){return[o($,{}),o(g,{get when(){return e.canRetry},get children(){return o(k,{size:"sm",disabled:!C,display:C?"block":"none",get loading(){return P()},onClick:async()=>{const e=await B();f(e,(()=>{x.info(t("tasks.retry")),I(!0)}))},get children(){return t("tasks.retry")}})}}),o(k,{size:"sm",colorScheme:"danger",get loading(){return T()},onClick:async()=>{const e=await F();f(e,(()=>{x.success(t("global.delete_success")),I(!0)}))},get children(){return t(`global.${A}`)}}),o(k,{size:"sm",colorScheme:"neutral",onClick:()=>{e.setLocal({selected:e.local.selected,expanded:!e.local.expanded})},get children(){return y((()=>!!e.local.expanded))()?t("tasks.fold"):t("tasks.expand")}})]}})]}}),o(g,{get when(){return e.local.expanded},get children(){return o(v,{css:{wordBreak:"break-all",fontSize:"0.8em"},w:"$full",pl:"$2",pr:"$2",get children(){return[o(_,{templateColumns:"min-content 1fr",w:"$full",columnGap:"$4",mb:"$2",get children(){return[o(g,{when:-1!==O,get children(){return[o(b,{color:"$neutral9",textAlign:"right",css:{whiteSpace:"nowrap"},get children(){return t("tasks.attr.time_elapsed")}}),o(b,{color:"$neutral9",get children(){return(e=>{const t=e/1e3%60,r=e/1e3/60%60;return`${M(e/1e3/3600)}:${M(r)}:${M(t)}`})(j-O)}})]}}),o(g,{when:null!==D,get children(){return o(S,{get each(){return Object.entries(e.nameAnalyzer.attrs)},children:e=>{const t=e[1](D);return void 0===t?null:o(g,{get when(){return void 0!==e[1]},get children(){return[o(b,{color:"$neutral9",textAlign:"right",css:{whiteSpace:"nowrap"},get children(){return e[0]}}),o(b,{color:"$neutral9",children:t})]}})}})}}),o(b,{color:"$neutral9",textAlign:"right",css:{whiteSpace:"nowrap"},get children(){return t("tasks.attr.status")}}),o(b,{color:"$neutral9",get children(){return e.status}}),o(g,{get when(){return e.error},get children(){return[o(b,{color:"$danger9",textAlign:"right",css:{whiteSpace:"nowrap"},get children(){return t("tasks.attr.err")}}),o(b,{color:"$danger9",get children(){return e.error}})]}})]}}),o(z,{})]}})}})]}})},N=e=>{const t=n(),[u,h]=a((()=>l.get(`/task/${e.type}/${e.done}`))),[p,_]=s([]),[b,S]=s("name"),[z,A]=s(!1),I={name:(e,t)=>e.name>t.name?1:-1,creator:(e,t)=>e.creator===t.creator?e.id>t.id?1:-1:e.creator>t.creator?1:-1,state:(e,t)=>e.state===t.state?e.id>t.id?1:-1:e.state>t.state?1:-1,progress:(e,t)=>e.progress===t.progress?e.id>t.id?1:-1:e.progress<t.progress?1:-1},D=C((()=>(e,t)=>(z()?-1:1)*I[b()](e,t))),L=async()=>{const e=await h();f(e,(e=>{const t=(new Date).getTime(),r={},n={},a={},l={},s={};for(const o of p())r[o.id]=o.curFetchTime,n[o.id]=o.prevFetchTime,a[o.id]=o.progress,l[o.id]=o.prevProgress,s[o.id]=o.local;_(e?.map((e=>{let o,c;e.progress===a[e.id]?(o=n[e.id],c=l[e.id]):(o=r[e.id],c=a[e.id]);const i=s[e.id]??{selected:!1,expanded:!1};return{...e,curFetchTime:t,prevFetchTime:o,prevProgress:c,local:i}})).sort(D())??[])}))};if(L(),"undone"===e.done){const e=setInterval(L,2e3);T((()=>clearInterval(e)))}const[O,j]=a((()=>l.post(`/task/${e.type}/clear_done`))),[E,W]=a((()=>l.post(`/task/${e.type}/clear_succeeded`))),[q,M]=a((()=>l.post(`/task/${e.type}/retry_failed`))),[N,X]=s(""),[H,Q]=s(new RegExp("")),[U,V]=s(!1);F((()=>{try{Q(new RegExp(N())),V(!1)}catch(e){V(!0)}}));const[Y,Z]=s(2!==r().role),ee=C((()=>{const e=H(),t=Y();return n=>e.test(n.name)&&(!t||n.creator===r().username)})),te=C((()=>p().filter(ee()))),re=C((()=>te().map((e=>e.local.selected)).every(Boolean))),ne=C((()=>te().map((e=>e.local.selected)).some(Boolean)&&!re())),ae=C((()=>te().map((e=>e.local.expanded)).every(Boolean))),le=()=>te().filter((e=>e.local.selected)).map((e=>e.id)),[se,oe]=a((()=>l.post(`/task/${e.type}/retry_some`,le()))),[ce,ie]=a((()=>l.post(`/task/${e.type}/${he}_some`,le()))),de=e=>{Object.entries(e).forEach((([e,t])=>{x.error(`${e}: ${t}`)}))},[ge,ue]=s(1),he="undone"===e.done?"cancel":"delete",pe=C((()=>{const e=20*(ge()-1),t=e+20;return te().slice(e,t)})),me=e=>({fontWeight:"bold",fontSize:"$sm",color:"$neutral11",textAlign:e.textAlign}),we=e=>({cursor:"pointer",onClick:()=>{b()===e.name?A(!z()):R((()=>{S(e.name),A(!1)})),L()}});return o(v,{w:"$full",alignItems:"start",spacing:"$2",get children(){return[o(d,{size:"lg",get children(){return t(`tasks.${e.done}`)}}),o(c,{gap:"$2",flexWrap:"wrap",get children(){return[o(g,{get when(){return"done"===e.done},get children(){return[o(k,{colorScheme:"accent",get loading(){return u()},onClick:L,get children(){return t("global.refresh")}}),o(k,{get loading(){return q()},onClick:async()=>{const e=await M();f(e,(()=>L()))},get children(){return t("tasks.retry_failed")}}),o(k,{colorScheme:"danger",get loading(){return O()},onClick:async()=>{const e=await j();f(e,(()=>L()))},get children(){return t("global.clear")}}),o(k,{colorScheme:"success",get loading(){return E()},onClick:async()=>{const e=await W();f(e,(()=>L()))},get children(){return t("tasks.clear_succeeded")}})]}}),o(g,{get when(){return e.canRetry},get children(){return o(k,{colorScheme:"primary",get loading(){return se()},onClick:async()=>{const e=await oe();f(e,(e=>{de(e),L()}))},get children(){return t("tasks.retry_selected")}})}}),o(k,{colorScheme:"warning",get loading(){return ce()},onClick:async()=>{const e=await ie();f(e,(e=>{de(e),L()}))},get children(){return t(`tasks.${he}_selected`)}}),o(P,{width:"auto",get placeholder(){return t("tasks.filter")},get value(){return N()},onInput:e=>X(e.target.value),get invalid(){return U()}}),o(g,{get when(){return 2===r().role},get children(){return o(i,{get checked(){return Y()},onChange:e=>Z(e.target.checked),get children(){return t("tasks.show_only_mine")}})}})]}}),o(v,{w:{"@initial":"1024px","@lg":"$full"},overflowX:"auto",shadow:"$md",rounded:"$lg",spacing:"$1",p:"$1",get children(){return[o(c,{class:"title",w:"$full",p:"$2",get children(){return[o(c,{get w(){return K[0].w},spacing:"$1",get children(){return[o(i,{get disabled(){return 0===te().length},get checked(){return re()},get indeterminate(){return ne()},onChange:e=>{return t=e.target.checked,_(p().map((e=>(ee()(e)&&(e.local.selected=t),e))));var t}}),o(m,B((()=>me(K[0])),(()=>we(K[0])),{get children(){return t(`tasks.attr.${K[0].name}`)}}))]}}),o(g,{get when(){return 2===r().role},get children(){return o(m,B({get w(){return K[1].w}},(()=>me(K[1])),(()=>we(K[1])),{get children(){return t(`tasks.attr.${K[1].name}`)}}))}}),o(m,B({get w(){return K[2].w}},(()=>me(K[2])),(()=>we(K[2])),{get children(){return t(`tasks.attr.${K[2].name}`)}})),o(m,B({get w(){return K[3].w}},(()=>me(K[3])),(()=>we(K[3])),{get children(){return t(`tasks.attr.${K[3].name}`)}})),o(m,B({get w(){return K[4].w}},(()=>me(K[4])),{get children(){return t(`tasks.attr.${K[4].name}`)}})),o(w,{get w(){return K[5].w},gap:"$2",get children(){return[o($,{}),o(m,B((()=>me(K[5])),{get children(){return t(`tasks.attr.${K[5].name}`)}})),o(k,{size:"xs",colorScheme:"neutral",onClick:()=>{return e=!ae(),_(p().map((t=>(ee()(t)&&(t.local.expanded=e),t))));var e},get disabled(){return 0===te().length},get children(){return y((()=>!!ae()))()?t("tasks.fold_all"):t("tasks.expand_all")}})]}})]}}),y((()=>pe().map((t=>o(J,B(t,e,{get setLocal(){return e=t.id,t=>_(p().map((r=>(r.id===e&&(r.local=t),r))));var e}}))))))]}}),o(G,{get total(){return te().length},defaultPageSize:20,onChange:e=>{ue(e)}})]}})};e("T",(e=>{const t=n();return o(v,{w:"$full",alignItems:"start",spacing:"$4",get children(){return[o(d,{size:"xl",get children(){return t(`tasks.${e.type}`)}}),o(v,{w:"$full",spacing:"$2",get children(){return o(S,{each:["undone","done"],children:t=>o(N,{get type(){return e.type},done:t,get canRetry(){return e.canRetry},get nameAnalyzer(){return e.nameAnalyzer}})})}})]}})}));var X=E("<a>"),H=E("<p>"),Q=E("<a target=_blank>");const U=e("b",((e,t,n=!0)=>{const a=("/"===e?"":e)+t,l="/"===r().base_path?"":r().base_path,o=a.startsWith(l),[c,i]=s(!1);return o&&n?((g=X()).$$mouseout=()=>i(!1),g.$$mouseover=()=>i(!0),D(g,a),L((e=>{var t=c()?"text-decoration: underline":"",r=a.slice(l.length);return e.e=O(g,t,e.e),r!==e.t&&j(g,"href",e.t=r),e}),{e:void 0,t:void 0}),g):(d=H(),D(d,a),d);var d,g}));e("g",(()=>{const e=n(),[t,r]=s(!1);return{regex:/^download (.+) to \((.+)\)$/,title:e=>e[1],attrs:{[e("tasks.attr.offline_download.url")]:e=>{return(n=Q()).$$mouseout=()=>r(!1),n.$$mouseover=()=>r(!0),D(n,(()=>e[1])),L((r=>{var a=t()?"text-decoration: underline":"",l=e[1];return r.e=O(n,a,r.e),l!==r.t&&j(n,"href",r.t=l),r}),{e:void 0,t:void 0}),n;var n},[e("tasks.attr.offline_download.path")]:e=>U("",e[2])}}})),e("a",(()=>{const e=n();return{regex:/^transfer \[(.*)]\((.*\/([^\/]+))\) to \[(.+)]\((.+)\)$/,title:e=>e[3],attrs:{[e("tasks.attr.offline_download.transfer_src")]:e=>""===e[1]?void 0:U(e[1],e[2]),[e("tasks.attr.offline_download.transfer_src_local")]:e=>""===e[1]?e[2]:void 0,[e("tasks.attr.offline_download.transfer_dst")]:e=>U(e[4],e[5])}}})),e("c",(()=>{const e=n();return{regex:/^decompress \[(.+)]\((.*\/([^\/]+))\)\[(.+)] to \[(.+)]\((.+)\) with password <(.*)>$/,title:e=>e[3],attrs:{[e("tasks.attr.decompress.src")]:e=>U(e[1],e[2]),[e("tasks.attr.decompress.dst")]:e=>U(e[5],e[6]),[e("tasks.attr.decompress.inner")]:e=>{return t=H(),D(t,(()=>e[4])),t;var t},[e("tasks.attr.decompress.password")]:e=>{return t=H(),D(t,(()=>e[7])),t;var t}}}})),e("d",(()=>{const e=n();return{regex:/^upload (.+) to \[(.+)]\((.+)\)$/,title:e=>e[1],attrs:{[e("tasks.attr.decompress.dst")]:e=>U(e[2],e[3])}}})),I(["mouseover","mouseout"])}}}));
