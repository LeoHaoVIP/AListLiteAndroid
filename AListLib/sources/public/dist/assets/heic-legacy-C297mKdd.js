System.register(["./index-legacy-CfXu3iPN.js"],function(e,t){"use strict";var r,i,n,s,a,o,c,l,h,y,f,d,w,u;return{setters:[e=>{r=e.j,i=e.B,n=e.a8,s=e.as,a=e.N,o=e.av,c=e.aZ,l=e.D,h=e.a9,y=e.S,f=e.a7,d=e.o,w=e.ck,u=e.e7}],execute:function(){var t=o("<div id=heic-container><canvas>");e("default",()=>{const e=d();r();const[o,p]=i(!0),[g,m]=i(!1);let v,P,b,j=n.objs.filter(e=>/\.(heic|heif|avif|vvc|avc|jpeg|jpg)$/i.test(e.name));0===j.length&&(j=[n.obj]),s(()=>{x()}),a(()=>{v&&P&&(P=null),v=null});const x=async()=>{p(!0),m(!1);try{window.libheif||await C("/static/libheif/libheif.js","libheif-script");const e=await _("/static/libheif/libheif.wasm");v=window.libheif({wasmBinary:e}),P=new v.HeifDecoder,await k(n.raw_url)}catch(e){console.error("HEIC初始化失败:",e),m(!0),p(!1)}},C=(e,t)=>new Promise((r,i)=>{const n=document.createElement("script");n.src=e,n.id=t,n.onload=()=>r(),n.onerror=()=>i(`脚本加载失败: ${e}`),document.head.appendChild(n)}),_=async e=>{const t=await fetch(e);if(!t.ok)throw`WASM加载失败: ${e}`;return await t.arrayBuffer()},k=async e=>{try{p(!0),m(!1);const t=await fetch(e);if(!t.ok)throw"文件获取失败";const r=await t.arrayBuffer(),i=P.decode(r);if(!i||0===i.length)throw"没有可解码的图像";const n=i[0];await B(n),p(!1)}catch(t){console.error("HEIC解码失败:",t),m(!0),p(!1)}},B=e=>new Promise(t=>{if(!b)return t();const r=e.get_width(),i=e.get_height();b.width=r,b.height=i;const n=new ImageData(r,i);e.display(n,e=>{if(!e||!b)return t();const r=b.getContext("2d");if(!r)return t();r.putImageData(e,0,0),t()})});return D=t(),I=D.firstChild,D.style.setProperty("position","relative"),D.style.setProperty("width","100%"),D.style.setProperty("height","75vh"),D.style.setProperty("display","flex"),D.style.setProperty("justify-content","center"),D.style.setProperty("align-items","center"),D.style.setProperty("overflow","hidden"),"function"==typeof b?u(b,I):b=I,I.style.setProperty("max-width","100%"),I.style.setProperty("max-height","100%"),I.style.setProperty("object-fit","contain"),c(D,l(y,{get when(){return o()},get children(){return l(h,{})}}),null),c(D,l(y,{get when(){return g()},get children(){return l(f,{get msg(){return e("preview.failed_load_heic")},h:"75vh"})}}),null),w(e=>null!=(e=o()||g()?"none":"block")?I.style.setProperty("display",e):I.style.removeProperty("display")),D;var D,I})}}});
