System.register(["./index-legacy-54a561d9.js"],(function(e,t){"use strict";var r,n,i,a,o,s,l,c,h,y,d,w,f,u;return{setters:[e=>{r=e.b,n=e.d,i=e.q,a=e.a5,o=e.am,s=e.x,l=e.a6,c=e.aT,h=e.y,y=e.a2,d=e.S,w=e.cd,f=e.as,u=e.d$}],execute:function(){var t=f("<div id=heic-container><canvas>");e("default",(()=>{const e=r(),{replace:f}=n(),[p,g]=i(!0),[m,v]=i(!1);let P=a.objs.filter((e=>/\.(heic|heif|avif|vvc|avc|jpeg|jpg)$/i.test(e.name)));0===P.length&&(P=[a.obj]);const b=e=>{const t=P.findIndex((e=>e.name===a.obj.name));"ArrowLeft"===e.key&&t>0?f(P[t-1].name):"ArrowRight"===e.key&&t<P.length-1&&f(P[t+1].name)};let j,x,k=null;o((()=>{window.addEventListener("keydown",b),C()})),s((()=>{window.removeEventListener("keydown",b),j&&x&&(x.free(),x=null),j=null}));const C=async()=>{g(!0),v(!1);try{window.libheif||await E("/static/libheif/libheif.js","libheif-script");const e=await I("/static/libheif/libheif.wasm");j=window.libheif({wasmBinary:e}),x=new j.HeifDecoder,await _(a.raw_url)}catch(e){console.error("HEIC初始化失败:",e),v(!0),g(!1)}},E=(e,t)=>new Promise(((r,n)=>{const i=document.createElement("script");i.src=e,i.id=t,i.onload=()=>r(),i.onerror=()=>n(new l(`脚本加载失败: ${e}`)),document.head.appendChild(i)})),I=async e=>{const t=await fetch(e);if(!t.ok)throw new l(`WASM加载失败: ${e}`);return await t.arrayBuffer()},_=async e=>{try{g(!0),v(!1);const t=await fetch(e);if(!t.ok)throw new l("文件获取失败");const r=await t.arrayBuffer(),n=x.decode(r);if(!n||0===n.length)throw new l("没有可解码的图像");const i=n[0];await $(i),g(!1)}catch(t){console.error("HEIC解码失败:",t),v(!0),g(!1)}},$=e=>new Promise((t=>{if(!k)return t();const r=e.get_width(),n=e.get_height();k.width=r,k.height=n;const i=new ImageData(r,n);e.display(i,(e=>{if(!e||!k)return t();const r=k.getContext("2d");if(!r)return t();r.putImageData(e,0,0),t()}))}));return A=t(),B=A.firstChild,A.style.setProperty("position","relative"),A.style.setProperty("width","100%"),A.style.setProperty("height","75vh"),A.style.setProperty("display","flex"),A.style.setProperty("justify-content","center"),A.style.setProperty("align-items","center"),A.style.setProperty("overflow","hidden"),"function"==typeof k?u(k,B):k=B,B.style.setProperty("max-width","100%"),B.style.setProperty("max-height","100%"),B.style.setProperty("object-fit","contain"),c(A,h(d,{get when(){return p()},get children(){return h(y,{})}}),null),c(A,h(d,{get when(){return m()},get children(){return h(l,{get msg(){return e("preview.failed_load_heic")},h:"75vh"})}}),null),w((e=>null!=(e=p()||m()?"none":"block")?B.style.setProperty("display",e):B.style.removeProperty("display"))),A;var A,B}))}}}));
