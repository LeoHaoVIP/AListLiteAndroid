import{cj as pe,Q as V,av as W,ck as Z,cl as S,a2 as z,D as e,ak as O,j as Q,cf as _,cm as $,N as X,aM as Y,ao as I,bq as v,c2 as he,cn as fe,co as me,cp as we,cq as be,a0 as k,O as Ce,o as ve,B as w,cr as _e,b9 as T,as as $e,ae as ye,bX as U,aK as xe,bY as ke,S as b,I as A,bc as H,ad as Se,au as Ie,K as B,bB as Le,bC as Ee,cs as Ge,aR as Re,ct as J,r as C,bt as Me}from"./index-BeFrtC4h.js";import{a as Pe}from"./useTitle-QM9-qgni.js";import{s as Oe,g as Te,a as Ue}from"./webauthn-json.browser-ponyfill-CVZeZdny.js";const Ae="https://github.com/alist-org/alist";function Be(s){return pe("".concat(s,"-").concat(Ae))}var ze=W('<svg version=1.1 xmlns=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink height=896 width=967.8852157128662><defs><path id=path-2 opacity=1 fill-rule=evenodd d="M896,448 C1142.6325445712241,465.5747656464056 695.2579309733121,896 448,896 C200.74206902668806,896 5.684341886080802e-14,695.2579309733121 0,448.0000000000001 C0,200.74206902668806 200.74206902668791,5.684341886080802e-14 447.99999999999994,0 C695.2579309733121,0 475,418 896,448Z"></path><linearGradient id=linearGradient-3 x1=0.5 y1=0 x2=0.5 y2=1><stop offset=0 stop-opacity=1></stop><stop offset=1 stop-opacity=1></stop></linearGradient></defs><g opacity=1><use href=#path-2 fill=url(#linearGradient-3) fill-opacity=1>');const Ke=s=>{const g=V({startColor:"#28aff0",endColor:"#120fc4"},s);return(()=>{var n=ze(),u=n.firstChild,p=u.firstChild,r=p.nextSibling,c=r.firstChild,a=c.nextSibling;return Z(t=>{var i=g.startColor,h=g.endColor;return i!==t.e&&S(c,"stop-color",t.e=i),h!==t.t&&S(a,"stop-color",t.t=h),t},{e:void 0,t:void 0}),n})()};var Fe=W('<svg height=1337 width=1337><defs><path id=path-1 opacity=1 fill-rule=evenodd d="M1337,668.5 C1337,1037.455193874239 1037.455193874239,1337 668.5,1337 C523.6725684305388,1337 337,1236 370.50000000000006,1094 C434.03835568300906,824.6732385973953 6.906089672974592e-14,892.6277623047779 0,668.5000000000001 C0,299.5448061257611 299.5448061257609,1.1368683772161603e-13 668.4999999999999,0 C1037.455193874239,0 1337,299.544806125761 1337,668.5Z"></path><linearGradient id=linearGradient-2 x1=0.79 y1=0.62 x2=0.21 y2=0.86><stop offset=0 stop-opacity=1></stop><stop offset=1 stop-opacity=1></stop></linearGradient></defs><g opacity=1><use href=#path-1 fill=url(#linearGradient-2) fill-opacity=1>');const je=s=>{const g=V({startColor:"#28aff0",endColor:"#120fc4"},s);return(()=>{var n=Fe(),u=n.firstChild,p=u.firstChild,r=p.nextSibling,c=r.firstChild,a=c.nextSibling;return Z(t=>{var i=g.startColor,h=g.endColor;return i!==t.e&&S(c,"stop-color",t.e=i),h!==t.t&&S(a,"stop-color",t.t=h),t},{e:void 0,t:void 0}),n})()},De=()=>{const s=z("#a9c6ff","#062b74");return e(O,{get bgColor(){return s()},pos:"fixed",top:"0",left:"0",overflow:"hidden",zIndex:"-1",w:"100vw",h:"100vh",get children(){return[e(O,{pos:"absolute",right:{"@initial":"-100px","@sm":"-300px"},top:{"@initial":"-1170px","@sm":"-900px"},get children(){return e(je,{})}}),e(O,{pos:"absolute",left:{"@initial":"-100px","@sm":"-200px"},bottom:{"@initial":"-760px","@sm":"-400px"},get children(){return e(Ke,{})}})]}})},Ne=()=>{const s=I("sso_login_enabled"),g=k("sso_login_platform"),n=I("sso_compatibility_mode"),{searchParams:u,to:p}=Q(),r=u.token;r!=null&&r!=""&&(_(r),p(decodeURIComponent(u.redirect||$||"/"),!0));function c(a){const t=a.data;t.token&&(_(t.token),p(decodeURIComponent(u.redirect||$||"/"),!0))}if(window.addEventListener("message",c),X(()=>{window.removeEventListener("message",c)}),s){const a=()=>{const i=v.getUri()+"/auth/sso?method=sso_get_token";if(n){window.location.href=i;return}window.open(i,"authPopup","width=500,height=600")};let t;switch(g){case"Github":t=be;break;case"Microsoft":t=we;break;case"Google":t=me;break;case"Dingtalk":t=fe;break;default:t=he}return e(Y,{cursor:"pointer",boxSize:"$8",as:t,p:"$0_5",onclick:a})}},Ve=()=>{const s=k("logo").split("\n"),g=z(s[0],s.pop()),n=ve(),u=Ce(()=>"".concat(n("login.login_to")," ").concat(k("site_title")));Pe(u);const p=z("white","$neutral1"),[r,c]=w(localStorage.getItem("username")||""),[a,t]=w(localStorage.getItem("password")||""),[i,h]=w(""),[y,ee]=w(!1),[x,te]=_e("remember-pwd","false"),[L,K]=w(!1),[ne,oe]=T(async()=>L()?v.post("/auth/login/ldap",{username:r(),password:a(),otp_code:i()}):v.post("/auth/login/hash",{username:r(),password:Be(a()),otp_code:i()})),[,re]=T((o,l,m,P)=>v.post("/authn/webauthn_finish_login?username="+m,JSON.stringify(l),{headers:{session:o},signal:P})),[,se]=T((o,l)=>v.get("/authn/webauthn_begin_login?username="+o,{signal:l})),{searchParams:E,to:G}=Q(),ae=async()=>PublicKeyCredential&&"isConditionalMediationAvailable"in PublicKeyCredential?await PublicKeyCredential.isConditionalMediationAvailable():!1,F=I("webauthn_login_enabled"),ie=async()=>{ee(!y())};let d=null;const j=async o=>{if(!Oe()){o||C.error(n("users.webauthn_not_supported"));return}if(o&&!await ae())return;d==null||d.abort();const l=new AbortController;d=l;const m=o?"":r();!o&&x()==="true"?localStorage.setItem("username",r()):localStorage.removeItem("username");const P=await se(m,l.signal);Me(P,async q=>{try{const f=Te(q.options);f.signal=l.signal,o&&(f.mediation="conditional");const ue=await Ue(f),de=await re(q.session,ue,m,l.signal);J(de,ge=>{C.success(n("login.success")),_(ge.token),G(decodeURIComponent(E.redirect||$||"/"),!0)})}catch(f){f instanceof Error&&f.name!="AbortError"&&C.error(f.message)}})},D=()=>d==null?void 0:d.abort();$e(()=>{F&&(window.addEventListener("beforeunload",D),j(!0))}),X(()=>{d==null||d.abort(),window.removeEventListener("beforeunload",D)});const R=async()=>{if(y())await j();else{x()==="true"?(localStorage.setItem("username",r()),localStorage.setItem("password",a())):(localStorage.removeItem("username"),localStorage.removeItem("password"));const o=await oe();J(o,l=>{C.success(n("login.success")),_(l.token),G(decodeURIComponent(E.redirect||$||"/"),!0)},(l,m)=>{!M()&&m===402?le(!0):C.error(l)})}},[M,le]=w(!1),N=I("ldap_login_enabled"),ce=k("ldap_login_tips");return N&&K(!0),e(Re,{zIndex:"1",w:"$full",h:"100vh",get children(){return[e(ye,{get bgColor(){return p()},rounded:"$xl",p:"24px",w:{"@initial":"90%","@sm":"364px"},spacing:"$4",get children(){return[e(U,{alignItems:"center",justifyContent:"space-around",get children(){return[e(xe,{mr:"$2",boxSize:"$12",get src(){return g()}}),e(ke,{color:"$info9",fontSize:"$2xl",get children(){return u()}})]}}),e(b,{get when(){return!M()},get fallback(){return e(A,{id:"totp",name:"otp",get placeholder(){return n("login.otp-tips")},get value(){return i()},onInput:o=>h(o.currentTarget.value),onKeyDown:o=>{o.key==="Enter"&&R()}})},get children(){return[e(A,{name:"username",get placeholder(){return n("login.username-tips")},get value(){return r()},onInput:o=>c(o.currentTarget.value)}),e(b,{get when(){return!y()},get children(){return e(A,{name:"password",get placeholder(){return n("login.password-tips")},type:"password",get value(){return a()},onInput:o=>t(o.currentTarget.value),onKeyDown:o=>{o.key==="Enter"&&R()}})}}),e(U,{px:"$1",w:"$full",fontSize:"$sm",color:"$neutral10",justifyContent:"space-between",alignItems:"center",get children(){return[e(H,{get checked(){return x()==="true"},onChange:()=>te(x()==="true"?"false":"true"),get children(){return n("login.remember")}}),e(Se,{as:"a",target:"_blank",get href(){return n("login.forget_url")},get children(){return n("login.forget")}})]}})]}}),e(Ie,{w:"$full",spacing:"$2",get children(){return[e(b,{get when(){return!y()},get children(){return e(B,{colorScheme:"primary",w:"$full",onClick:()=>{M()?h(""):(c(""),t(""))},get children(){return n("login.clear")}})}}),e(B,{w:"$full",get loading(){return ne()},onClick:R,get children(){return n("login.login")}})]}}),e(b,{when:N,get children(){return e(H,{w:"$full",get checked(){return L()===!0},onChange:()=>K(!L()),children:ce})}}),e(B,{w:"$full",colorScheme:"accent",onClick:()=>{_(),G(decodeURIComponent(E.redirect||$||"/"),!0)},get children(){return n("login.use_guest")}}),e(U,{mt:"$2",justifyContent:"space-evenly",alignItems:"center",color:"$neutral10",w:"$full",get children(){return[e(Le,{}),e(Ee,{}),e(Ne,{}),e(b,{when:F,get children(){return e(Y,{cursor:"pointer",boxSize:"$8",as:Ge,p:"$0_5",onclick:ie})}})]}})]}}),e(De,{})]}})};export{Ve as default};
