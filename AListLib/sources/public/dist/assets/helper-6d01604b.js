import{ay as k,b as P,b9 as b,bq as A,B as w,x as t,av as W,bb as E,bW as ne,S as m,aS as Y,cE as We,cF as Ge,ah as B,bX as we,dn as $e,Q as x,br as z,n as ee,am as te,ai as G,dp as Ve,dq as F,W as ye,dr as je,cC as xe,A as D,r as He,H as Ue,L as qe,V as T,E as Xe,ds as Ke,a_ as V,ci as ve,dt as _e,cj as ke,az as ae}from"./index-bda5f188.js";import{P as Qe}from"./Paginator-11e6608e.js";var L;(function(e){e[e.Pending=0]="Pending",e[e.Running=1]="Running",e[e.Succeeded=2]="Succeeded",e[e.Canceling=3]="Canceling",e[e.Canceled=4]="Canceled",e[e.Errored=5]="Errored",e[e.Failing=6]="Failing",e[e.Failed=7]="Failed",e[e.WaitingRetry=8]="WaitingRetry",e[e.BeforeRetry=9]="BeforeRetry"})(L||(L={}));const Je={[L.Failed]:"danger",[L.Succeeded]:"success",[L.Canceled]:"neutral"},Ye=e=>{if(e.role<0)return null;const n=["info","neutral","accent"];return t(xe,{get colorScheme(){return n[e.role]},css:{overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis"},get children(){return e.name}})},Ze=e=>{const n=P();return t(xe,{get colorScheme(){return Je[e.state]??"info"},get children(){return n(`tasks.state.${e.state}`)}})},l=[{name:"name",textAlign:"left",w:k().role===2?"calc(100% - 660px)":"calc(100% - 560px)"},{name:"creator",textAlign:"center",w:k().role===2?"100px":"0"},{name:"state",textAlign:"center",w:"100px"},{name:"progress",textAlign:"left",w:"140px"},{name:"speed",textAlign:"center",w:"100px"},{name:"operation",textAlign:"right",w:"220px"}],Z=e=>Math.floor(e).toString().padStart(2,"0"),Ee=e=>{const n=e/1e3%60,s=e/1e3/60%60,i=e/1e3/3600;return`${Z(i)}:${Z(s)}:${Z(n)}`},et=e=>{const n=P(),s=e.done==="undone"?"cancel":"delete",i=e.done==="done"&&(e.state===L.Failed||e.state===L.Canceled),[d,g]=b(()=>A.post(`/task/${e.type}/${s}?tid=${e.id}`)),[p,v]=b(()=>A.post(`/task/${e.type}/retry?tid=${e.id}`)),[u,f]=w(!1),C=e.name.match(e.nameAnalyzer.regex),N=C===null?e.name:e.nameAnalyzer.title(C),h=e.start_time===null?-1:new Date(e.start_time).getTime(),j=e.end_time===null?new Date().getTime():new Date(e.end_time).getTime();let O="-";const H=(c,$)=>{let _=$/c,R="bytes/s";return _>1024&&(_/=1024,R="KB/s"),_>1024&&(_/=1024,R="MB/s"),_>1024&&(_/=1024,R="GB/s"),`${_.toFixed(2)} ${R}`};if(e.done){if(e.start_time!==e.end_time&&e.progress>0&&h!==-1){const c=(j-h)/1e3,$=e.total_bytes*e.progress/100;O=H(c,$)}}else if(e.prevProgress!==void 0&&e.prevFetchTime!==void 0){const c=(e.curFetchTime-e.prevFetchTime)/1e3,$=(e.progress-e.prevProgress)*e.total_bytes/100;O=H(c,$)}return t(m,{get when(){return!u()},get children(){return[t(W,{w:"$full",p:"$2",get children(){return[t(W,{get w(){return l[0].w},spacing:"$1",get children(){return[t(E,{"on:click":c=>{c.stopPropagation()},get checked(){return e.local.selected},onChange:c=>{e.setLocal({selected:c.target.checked,expanded:e.local.expanded})}}),t(ne,{size:"sm",css:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:N})]}}),t(m,{get when(){return k().role===2},get children(){return t(Y,{get w(){return l[1].w},get children(){return t(Ye,{get name(){return e.creator},get role(){return e.creator_role}})}})}}),t(Y,{get w(){return l[2].w},get children(){return t(Ze,{get state(){return e.state}})}}),t(We,{get w(){return l[3].w},trackColor:"$info3",rounded:"$full",size:"sm",get value(){return e.progress},mr:"$1",get children(){return t(Ge,{color:"$info8",rounded:"$md"})}}),t(Y,{get w(){return l[1].w},get children(){return t(B,{size:"sm",css:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:O})}}),t(we,{get w(){return l[5].w},gap:"$1",get children(){return[t($e,{}),t(m,{get when(){return e.canRetry},get children(){return t(x,{size:"sm",disabled:!i,display:i?"block":"none",get loading(){return p()},onClick:async()=>{const c=await v();z(c,()=>{ee.info(n("tasks.retry")),f(!0)})},get children(){return n("tasks.retry")}})}}),t(x,{size:"sm",colorScheme:"danger",get loading(){return d()},onClick:async()=>{const c=await g();z(c,()=>{ee.success(n("global.delete_success")),f(!0)})},get children(){return n(`global.${s}`)}}),t(x,{size:"sm",colorScheme:"neutral",onClick:()=>{e.setLocal({selected:e.local.selected,expanded:!e.local.expanded})},get children(){return te(()=>!!e.local.expanded,!0)()?n("tasks.fold"):n("tasks.expand")}})]}})]}}),t(m,{get when(){return e.local.expanded},get children(){return t(G,{css:{wordBreak:"break-all",fontSize:"0.8em"},w:"$full",pl:"$2",pr:"$2",get children(){return[t(Ve,{templateColumns:"min-content 1fr",w:"$full",columnGap:"$4",mb:"$2",get children(){return[t(m,{when:h!==-1,get children(){return[t(F,{color:"$neutral9",textAlign:"right",css:{whiteSpace:"nowrap"},get children(){return n("tasks.attr.time_elapsed")}}),t(F,{color:"$neutral9",get children(){return Ee(j-h)}})]}}),t(m,{when:C!==null,get children(){return t(ye,{get each(){return Object.entries(e.nameAnalyzer.attrs)},children:c=>{const $=c[1](C);return $===void 0?null:t(m,{get when(){return c[1]!==void 0},get children(){return[t(F,{color:"$neutral9",textAlign:"right",css:{whiteSpace:"nowrap"},get children(){return c[0]}}),t(F,{color:"$neutral9",children:$})]}})}})}}),t(F,{color:"$neutral9",textAlign:"right",css:{whiteSpace:"nowrap"},get children(){return n("tasks.attr.status")}}),t(F,{color:"$neutral9",get children(){return e.status}}),t(m,{get when(){return e.error},get children(){return[t(F,{color:"$danger9",textAlign:"right",css:{whiteSpace:"nowrap"},get children(){return n("tasks.attr.err")}}),t(F,{color:"$danger9",get children(){return e.error}})]}})]}}),t(je,{})]}})}})]}})},tt=e=>{const n=P(),[s,i]=b(()=>A.get(`/task/${e.type}/${e.done}`)),[d,g]=w([]),[p,v]=w("name"),[u,f]=w(!1),C={name:(r,a)=>r.name>a.name?1:-1,creator:(r,a)=>r.creator===a.creator?r.id>a.id?1:-1:r.creator>a.creator?1:-1,state:(r,a)=>r.state===a.state?r.id>a.id?1:-1:r.state>a.state?1:-1,progress:(r,a)=>r.progress===a.progress?r.id>a.id?1:-1:r.progress<a.progress?1:-1},N=D(()=>(r,a)=>(u()?-1:1)*C[p()](r,a)),h=async()=>{const r=await i();z(r,a=>{const y=new Date().getTime(),ue={},he={},K={},me={},fe={};for(const o of d())ue[o.id]=o.curFetchTime,he[o.id]=o.prevFetchTime,K[o.id]=o.progress,me[o.id]=o.prevProgress,fe[o.id]=o.local;g((a==null?void 0:a.map(o=>{let Q,J;o.progress===K[o.id]?(Q=he[o.id],J=me[o.id]):(Q=ue[o.id],J=K[o.id]);const Oe=fe[o.id]??{selected:!1,expanded:!1};return{...o,curFetchTime:y,prevFetchTime:Q,prevProgress:J,local:Oe}}).sort(N()))??[])})};if(h(),e.done==="undone"){const r=setInterval(h,2e3);He(()=>clearInterval(r))}const[j,O]=b(()=>A.post(`/task/${e.type}/clear_done`)),[H,c]=b(()=>A.post(`/task/${e.type}/clear_succeeded`)),[$,_]=b(()=>A.post(`/task/${e.type}/retry_failed`)),[R,pe]=w(""),[Ce,Se]=w(new RegExp("")),[Fe,le]=w(!1);Ue(()=>{try{Se(new RegExp(R())),le(!1)}catch{le(!0)}});const[se,be]=w(k().role!==2),q=D(()=>{const r=Ce(),a=se();return y=>r.test(y.name)&&(!a||y.creator===k().username)}),S=D(()=>d().filter(q())),ce=D(()=>S().map(r=>r.local.selected).every(Boolean)),Ae=D(()=>S().map(r=>r.local.selected).some(Boolean)&&!ce()),ze=r=>g(d().map(a=>(q()(a)&&(a.local.selected=r),a))),oe=D(()=>S().map(r=>r.local.expanded).every(Boolean)),Pe=r=>g(d().map(a=>(q()(a)&&(a.local.expanded=r),a))),ie=()=>S().filter(r=>r.local.selected).map(r=>r.id),[Re,De]=b(()=>A.post(`/task/${e.type}/retry_some`,ie())),[Te,Be]=b(()=>A.post(`/task/${e.type}/${ge}_some`,ie())),de=r=>{Object.entries(r).forEach(([a,y])=>{ee.error(`${a}: ${y}`)})},[Le,Ne]=w(1),X=20,ge=e.done==="undone"?"cancel":"delete",Ie=D(()=>{const r=(Le()-1)*X,a=r+X;return S().slice(r,a)}),I=r=>({fontWeight:"bold",fontSize:"$sm",color:"$neutral11",textAlign:r.textAlign}),U=r=>({cursor:"pointer",onClick:()=>{p()===r.name?f(!u()):Xe(()=>{v(r.name),f(!1)}),h()}}),Me=r=>a=>g(d().map(y=>(y.id===r&&(y.local=a),y)));return t(G,{w:"$full",alignItems:"start",spacing:"$2",get children(){return[t(ne,{size:"lg",get children(){return n(`tasks.${e.done}`)}}),t(W,{gap:"$2",flexWrap:"wrap",get children(){return[t(m,{get when(){return e.done==="done"},get children(){return[t(x,{colorScheme:"accent",get loading(){return s()},onClick:h,get children(){return n("global.refresh")}}),t(x,{get loading(){return $()},onClick:async()=>{const r=await _();z(r,()=>h())},get children(){return n("tasks.retry_failed")}}),t(x,{colorScheme:"danger",get loading(){return j()},onClick:async()=>{const r=await O();z(r,()=>h())},get children(){return n("global.clear")}}),t(x,{colorScheme:"success",get loading(){return H()},onClick:async()=>{const r=await c();z(r,()=>h())},get children(){return n("tasks.clear_succeeded")}})]}}),t(m,{get when(){return e.canRetry},get children(){return t(x,{colorScheme:"primary",get loading(){return Re()},onClick:async()=>{const r=await De();z(r,a=>{de(a),h()})},get children(){return n("tasks.retry_selected")}})}}),t(x,{colorScheme:"warning",get loading(){return Te()},onClick:async()=>{const r=await Be();z(r,a=>{de(a),h()})},get children(){return n(`tasks.${ge}_selected`)}}),t(qe,{width:"auto",get placeholder(){return n("tasks.filter")},get value(){return R()},onInput:r=>pe(r.target.value),get invalid(){return Fe()}}),t(m,{get when(){return k().role===2},get children(){return t(E,{get checked(){return se()},onChange:r=>be(r.target.checked),get children(){return n("tasks.show_only_mine")}})}})]}}),t(G,{w:{"@initial":"1024px","@lg":"$full"},overflowX:"auto",shadow:"$md",rounded:"$lg",spacing:"$1",p:"$1",get children(){return[t(W,{class:"title",w:"$full",p:"$2",get children(){return[t(W,{get w(){return l[0].w},spacing:"$1",get children(){return[t(E,{get disabled(){return S().length===0},get checked(){return ce()},get indeterminate(){return Ae()},onChange:r=>ze(r.target.checked)}),t(B,T(()=>I(l[0]),()=>U(l[0]),{get children(){return n(`tasks.attr.${l[0].name}`)}}))]}}),t(m,{get when(){return k().role===2},get children(){return t(B,T({get w(){return l[1].w}},()=>I(l[1]),()=>U(l[1]),{get children(){return n(`tasks.attr.${l[1].name}`)}}))}}),t(B,T({get w(){return l[2].w}},()=>I(l[2]),()=>U(l[2]),{get children(){return n(`tasks.attr.${l[2].name}`)}})),t(B,T({get w(){return l[3].w}},()=>I(l[3]),()=>U(l[3]),{get children(){return n(`tasks.attr.${l[3].name}`)}})),t(B,T({get w(){return l[4].w}},()=>I(l[4]),{get children(){return n(`tasks.attr.${l[4].name}`)}})),t(we,{get w(){return l[5].w},gap:"$2",get children(){return[t($e,{}),t(B,T(()=>I(l[5]),{get children(){return n(`tasks.attr.${l[5].name}`)}})),t(x,{size:"xs",colorScheme:"neutral",onClick:()=>Pe(!oe()),get disabled(){return S().length===0},get children(){return te(()=>!!oe(),!0)()?n("tasks.fold_all"):n("tasks.expand_all")}})]}})]}}),te(()=>Ie().map(r=>t(et,T(r,e,{get setLocal(){return Me(r.id)}}))))]}}),t(Qe,{get total(){return S().length},defaultPageSize:X,onChange:r=>{Ne(r)}})]}})},st=e=>{const n=P();return t(G,{w:"$full",alignItems:"start",spacing:"$4",get children(){return[t(ne,{size:"xl",get children(){return n(`tasks.${e.type}`)}}),t(G,{w:"$full",spacing:"$2",get children(){return t(ye,{each:["undone","done"],children:s=>t(tt,{get type(){return e.type},done:s,get canRetry(){return e.canRetry},get nameAnalyzer(){return e.nameAnalyzer}})})}})]}})},rt=ae("<a></a>"),re=ae("<p></p>"),nt=ae('<a target="_blank"></a>'),M=(e,n,s=!0)=>{const i=(e==="/"?"":e)+n,d=k().base_path==="/"?"":k().base_path,g=i.startsWith(d),[p,v]=w(!1);return g&&s?(()=>{const u=rt.cloneNode(!0);return u.$$mouseout=()=>v(!1),u.$$mouseover=()=>v(!0),V(u,i),ve(f=>{const C=p()?"text-decoration: underline":"",N=i.slice(d.length);return f._v$=_e(u,C,f._v$),N!==f._v$2&&ke(u,"href",f._v$2=N),f},{_v$:void 0,_v$2:void 0}),u})():(()=>{const u=re.cloneNode(!0);return V(u,i),u})()},ct=()=>{const e=P(),[n,s]=w(!1);return{regex:/^download (.+) to \((.+)\)$/,title:i=>i[1],attrs:{[e("tasks.attr.offline_download.url")]:i=>(()=>{const d=nt.cloneNode(!0);return d.$$mouseout=()=>s(!1),d.$$mouseover=()=>s(!0),V(d,()=>i[1]),ve(g=>{const p=n()?"text-decoration: underline":"",v=i[1];return g._v$3=_e(d,p,g._v$3),v!==g._v$4&&ke(d,"href",g._v$4=v),g},{_v$3:void 0,_v$4:void 0}),d})(),[e("tasks.attr.offline_download.path")]:i=>M("",i[2])}}},ot=()=>{const e=P();return{regex:/^transfer \[(.*)]\((.*\/([^\/]+))\) to \[(.+)]\((.+)\)$/,title:n=>n[3],attrs:{[e("tasks.attr.offline_download.transfer_src")]:n=>n[1]===""?void 0:M(n[1],n[2]),[e("tasks.attr.offline_download.transfer_src_local")]:n=>n[1]===""?n[2]:void 0,[e("tasks.attr.offline_download.transfer_dst")]:n=>M(n[4],n[5])}}},it=()=>{const e=P();return{regex:/^decompress \[(.+)]\((.*\/([^\/]+))\)\[(.+)] to \[(.+)]\((.+)\) with password <(.*)>$/,title:n=>n[3],attrs:{[e("tasks.attr.decompress.src")]:n=>M(n[1],n[2]),[e("tasks.attr.decompress.dst")]:n=>M(n[5],n[6]),[e("tasks.attr.decompress.inner")]:n=>(()=>{const s=re.cloneNode(!0);return V(s,()=>n[4]),s})(),[e("tasks.attr.decompress.password")]:n=>(()=>{const s=re.cloneNode(!0);return V(s,()=>n[7]),s})()}}},dt=()=>{const e=P();return{regex:/^upload (.+) to \[(.+)]\((.+)\)$/,title:n=>n[1],attrs:{[e("tasks.attr.decompress.dst")]:n=>M(n[2],n[3])}}};Ke(["mouseover","mouseout"]);export{st as T,ot as a,M as b,it as c,dt as d,ct as g};
