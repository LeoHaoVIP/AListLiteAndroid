System.register(["./index-legacy-Y5QILZVX.js"],function(e,t){"use strict";var r,i,n,a,s,o,l,c,h,y,d,f,w,u,p;return{setters:[e=>{r=e.j,i=e.B,n=e.d$,a=e.a8,s=e.as,o=e.N,l=e.av,c=e.aZ,h=e.D,y=e.a9,d=e.S,f=e.a7,w=e.o,u=e.ck,p=e.e7}],execute:function(){var t=l("<div id=heic-container><canvas>");e("default",()=>{const e=w();r();const[l,g]=i(!0),[m,v]=i(!1),{libHeifPath:P}=n();let b,j,x,$=a.objs.filter(e=>/\.(heic|heif|avif|vvc|avc|jpeg|jpg)$/i.test(e.name));0===$.length&&($=[a.obj]),s(()=>{C()}),o(()=>{b&&j&&(j=null),b=null});const C=async()=>{g(!0),v(!1);try{window.libheif||await _(`${P()}/libheif.js`,"libheif-script");const e=await k(`${P()}/libheif.wasm`);b=window.libheif({wasmBinary:e}),j=new b.HeifDecoder,await B(a.raw_url)}catch(e){console.error("HEIC初始化失败:",e),v(!0),g(!1)}},_=(e,t)=>new Promise((r,i)=>{const n=document.createElement("script");n.src=e,n.id=t,n.onload=()=>r(),n.onerror=()=>i(`脚本加载失败: ${e}`),document.head.appendChild(n)}),k=async e=>{const t=await fetch(e);if(!t.ok)throw`WASM加载失败: ${e}`;return await t.arrayBuffer()},B=async e=>{try{g(!0),v(!1);const t=await fetch(e);if(!t.ok)throw"文件获取失败";const r=await t.arrayBuffer(),i=j.decode(r);if(!i||0===i.length)throw"没有可解码的图像";const n=i[0];await D(n),g(!1)}catch(t){console.error("HEIC解码失败:",t),v(!0),g(!1)}},D=e=>new Promise(t=>{if(!x)return t();const r=e.get_width(),i=e.get_height();x.width=r,x.height=i;const n=new ImageData(r,i);e.display(n,e=>{if(!e||!x)return t();const r=x.getContext("2d");if(!r)return t();r.putImageData(e,0,0),t()})});return H=t(),I=H.firstChild,H.style.setProperty("position","relative"),H.style.setProperty("width","100%"),H.style.setProperty("height","75vh"),H.style.setProperty("display","flex"),H.style.setProperty("justify-content","center"),H.style.setProperty("align-items","center"),H.style.setProperty("overflow","hidden"),"function"==typeof x?p(x,I):x=I,I.style.setProperty("max-width","100%"),I.style.setProperty("max-height","100%"),I.style.setProperty("object-fit","contain"),c(H,h(d,{get when(){return l()},get children(){return h(y,{})}}),null),c(H,h(d,{get when(){return m()},get children(){return h(f,{get msg(){return e("preview.failed_load_heic")},h:"75vh"})}}),null),u(e=>null!=(e=l()||m()?"none":"block")?I.style.setProperty("display",e):I.style.removeProperty("display")),H;var H,I})}}});
