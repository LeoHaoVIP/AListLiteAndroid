import{ay as j,dD as E,B as u,ba as d,br as h,dE as W,dF as X,aZ as A,D as e,o as G,c1 as x,ax as F,aN as U,ai as N,ah as b,ac as l,cD as k,cQ as Y,S as P,a3 as H,K as i,M as ee,E as te,bv as re,F as ne,G as se,T as ae,I as D,J as oe,L as ie,bu as O,bc as g,bF as z,bS as de}from"./index-BuiRiVor.js";import{G as le}from"./index-59OJwQ3V.js";import ce from"./Common-C09KQqwn.js";import"./useTitle-DTrRaS7q.js";import"./index-rvsSbOjI.js";import"./index-xofFA_oy.js";import"./SettingItem-CDGmRu3V.js";import"./item_type-CyD6qwPS.js";import"./ResponsiveGrid-B3-0zh9l.js";var ue=j('<svg width=1em height=1em viewBox="0 0 24 24"><g fill=none stroke=currentColor stroke-linecap=round stroke-width=2><path stroke-dasharray=60 stroke-dashoffset=60 stroke-opacity=.3 d="M12 3C16.9706 3 21 7.02944 21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3Z"><animate fill=freeze attributeName=stroke-dashoffset dur=1.3s values=60;0></animate></path><path stroke-dasharray=15 stroke-dashoffset=15 d="M12 3C16.9706 3 21 7.02944 21 12"><animate fill=freeze attributeName=stroke-dashoffset dur=0.3s values=15;0></animate><animateTransform attributeName=transform dur=1.5s repeatCount=indefinite type=rotate values="0 12 12;360 12 12">'),ge=j('<svg width=1em height=1em viewBox="0 0 24 24"><g stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2><path fill=currentColor fill-opacity=0 stroke-dasharray=60 stroke-dashoffset=60 d="M3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12Z"><animate fill=freeze attributeName=stroke-dashoffset dur=0.5s values=60;0></animate><animate fill=freeze attributeName=fill-opacity begin=0.8s dur=0.15s values=0;0.3></animate></path><path fill=none stroke-dasharray=14 stroke-dashoffset=14 d="M8 12L11 15L16 10"><animate fill=freeze attributeName=stroke-dashoffset begin=0.6s dur=0.2s values=14;0>');function he(r){return(()=>{var s=ue();return E(s,r,!0,!0),s})()}function pe(r){return(()=>{var s=ge();return E(s,r,!0,!0),s})()}const me=()=>{const r=G(),[s,C]=u(),[q,y]=d(()=>h.get("/admin/index/progress")),[p,m]=u(),f=t=>{p()&&clearTimeout(p()),m(t?window.setTimeout(a,5e3):void 0)},a=async()=>{const t=await y();O(t,o=>{C(o),f(!o.is_done)},(o,B)=>{f(B!==404)})};a();const[$,S]=d(W),I=async()=>{const t=await S();g(t),a()},[v,T]=d(()=>h.post("/admin/index/clear")),w=async()=>{const t=await T();g(t),a()},[L,M]=d(()=>h.post("/admin/index/stop")),R=async()=>{const t=await M();g(t),a()};let c,n;const[_,Z]=d(X),V=async()=>{let t=[];c.value&&(t=c.value.split("\n"));let o=20;n.value&&(o=parseInt(n.value));const B=await Z(t,o);g(B),a()},{isOpen:J,onOpen:K,onClose:Q}=A();return[e(x,{get children(){return r("indexes.index_header")}}),e(ce,{get group(){return le.INDEX}}),e(x,{get children(){return r("indexes.current")}}),e(P,{get when(){return s()},get children(){return e(F,{spacing:"$2",w:"fit-content",shadow:"$md",rounded:"$lg",get bg(){return H("","$neutral3")()},get children(){return[e(U,{boxSize:"$28",color:"$accent9",p:"$2",get as(){var t;return(t=s())!=null&&t.is_done?pe:he}}),e(N,{spacing:"$2",flex:"1",alignItems:"start",mr:"$2",get children(){return[e(b,{get children(){return[l(()=>r("indexes.obj_count")),":",e(k,{colorScheme:"info",ml:"$2",get children(){var t;return(t=s())==null?void 0:t.obj_count}})]}}),e(b,{get children(){return[l(()=>r("indexes.last_done_time")),":",e(k,{colorScheme:"accent",ml:"$2",get children(){return l(()=>!!s().last_done_time)()?Y(s().last_done_time):r("indexes.unknown")}})]}}),e(P,{get when(){var t;return(t=s())==null?void 0:t.error},get children(){return e(b,{css:{wordBreak:"break-all"},get children(){return[l(()=>r("indexes.error")),":",e(k,{colorScheme:"danger",ml:"$2",get children(){return s().error}})]}})}})]}})]}})}}),e(F,{spacing:"$2",get children(){return[e(i,{colorScheme:"accent",onClick:[a,void 0],get loading(){return q()},get children(){return r("global.refresh")}}),e(i,{colorScheme:"danger",onClick:[w,void 0],get loading(){return v()},get children(){return r("indexes.clear")}}),e(i,{colorScheme:"warning",onClick:[R,void 0],get loading(){return L()},get children(){return r("indexes.stop")}}),e(i,{onClick:[I,void 0],get loading(){return $()},get children(){var t;return r("indexes.".concat((t=s())!=null&&t.is_done?"rebuild":"build"))}})]}}),e(i,{onClick:K,get children(){return r("indexes.update")}}),e(ie,{get opened(){return J()},onClose:Q,get children(){return[e(ee,{}),e(te,{get children(){return[e(re,{}),e(ne,{get children(){return r("indexes.update")}}),e(se,{get children(){return[e(x,{get children(){return r("indexes.paths_to_update")}}),e(ae,{ref(t){var o=c;typeof o=="function"?o(t):c=t}}),e(x,{get children(){return r("indexes.max_depth")}}),e(D,{value:20,type:"number",ref(t){var o=n;typeof o=="function"?o(t):n=t}})]}}),e(oe,{get children(){return e(i,{onClick:[V,void 0],get loading(){return _()},get children(){return r("indexes.update")}})}})]}})]}})]},fe=()=>{const r=G(),[s,C]=u(),[q,y]=d(()=>h.get("/admin/scan/progress")),[p,m]=u(),f=n=>{p()&&clearTimeout(p()),m(n?window.setTimeout(a,5e3):void 0)},a=async()=>{const n=await y();O(n,_=>{C(_),f(!_.is_done)},()=>{f(!0)})};a();const[$,S]=d(()=>h.post("/admin/scan/stop")),I=async()=>{const n=await S();g(n),a()},[v,T]=u("/"),[w,L]=u(0),[M,R]=d(()=>h.post("/admin/scan/start",{path:v(),limit:w()})),c=async()=>{const n=await R();g(n),a()};return[e(x,{get children(){return r("indexes.scan_header")}}),e(P,{get when(){return s()},get children(){return e(N,{alignItems:"start",spacing:"$2",w:"fit-content",p:"$2",shadow:"$md",rounded:"$lg",get bg(){return H("","$neutral3")()},get children(){return[e(b,{get children(){return[l(()=>r("indexes.task_status")),":",e(k,{get colorScheme(){var n;return(n=s())!=null&&n.is_done?"accent":"success"},ml:"$2",get children(){return l(()=>{var n;return!!((n=s())!=null&&n.is_done)})()?r("indexes.idle"):r("indexes.running")}})]}}),e(b,{get children(){return[l(()=>r("indexes.obj_count")),":",e(k,{colorScheme:"info",ml:"$2",get children(){var n;return(n=s())==null?void 0:n.obj_count}})]}}),e(i,{colorScheme:"danger",onClick:I,get loading(){return $()},get disabled(){var n;return(n=s())==null?void 0:n.is_done},get children(){return r("indexes.stop")}})]}})}}),e(de,{w:"100%",display:"flex",flexDirection:"column",get children(){return[e(z,{display:"flex",alignItems:"center",get children(){return r("indexes.path_to_scan")}}),e(D,{get value(){return v()},onInput:n=>T(n.currentTarget.value)}),e(z,{display:"flex",alignItems:"center",get children(){return r("indexes.rate_limit")}}),e(D,{type:"number",get value(){return w()},step:.1,onInput:n=>L(parseFloat(n.currentTarget.value))})]}}),e(i,{colorScheme:"info",onClick:c,get loading(){return M()},get children(){return r("indexes.start")}})]},Se=()=>e(N,{spacing:"$2",w:"$full",alignItems:"start",get children(){return[e(me,{}),e(fe,{})]}});export{Se as default};
