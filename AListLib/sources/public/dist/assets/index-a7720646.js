import{f as d,m as g,t as q,s as D,p as b}from"./index-bda5f188.js";const v={tokenize:P,concrete:!0},C={tokenize:I,partial:!0};function P(t,u,l){const i=this,n=i.events[i.events.length-1],m=n&&n[1].type==="linePrefix"?n[2].sliceSerialize(n[1],!0).length:0;let o=0;return c;function c(e){return t.enter("mathFlow"),t.enter("mathFlowFence"),t.enter("mathFlowFenceSequence"),r(e)}function r(e){return e===36?(t.consume(e),o++,r):o<2?l(e):(t.exit("mathFlowFenceSequence"),d(t,h,"whitespace")(e))}function h(e){return e===null||g(e)?F(e):(t.enter("mathFlowFenceMeta"),t.enter("chunkString",{contentType:"string"}),s(e))}function s(e){return e===null||g(e)?(t.exit("chunkString"),t.exit("mathFlowFenceMeta"),F(e)):e===36?l(e):(t.consume(e),s)}function F(e){return t.exit("mathFlowFence"),i.interrupt?u(e):t.attempt(C,p,M)(e)}function p(e){return t.attempt({tokenize:z,partial:!0},M,x)(e)}function x(e){return(m?d(t,w,"linePrefix",m+1):w)(e)}function w(e){return e===null?M(e):g(e)?t.attempt(C,p,M)(e):(t.enter("mathFlowValue"),a(e))}function a(e){return e===null||g(e)?(t.exit("mathFlowValue"),w(e)):(t.consume(e),a)}function M(e){return t.exit("mathFlow"),u(e)}function z(e,S,y){let T=0;return d(e,$,"linePrefix",i.parser.constructs.disable.null.includes("codeIndented")?void 0:4);function $(f){return e.enter("mathFlowFence"),e.enter("mathFlowFenceSequence"),k(f)}function k(f){return f===36?(T++,e.consume(f),k):T<o?y(f):(e.exit("mathFlowFenceSequence"),d(e,E,"whitespace")(f))}function E(f){return f===null||g(f)?(e.exit("mathFlowFence"),S(f)):y(f)}}}function I(t,u,l){const i=this;return n;function n(o){return o===null?u(o):(t.enter("lineEnding"),t.consume(o),t.exit("lineEnding"),m)}function m(o){return i.parser.lazy[i.now().line]?l(o):u(o)}}function N(t){let l=(t||{}).singleDollarTextMath;return l==null&&(l=!0),{tokenize:i,resolve:O,previous:L};function i(n,m,o){let c=0,r,h;return s;function s(a){return n.enter("mathText"),n.enter("mathTextSequence"),F(a)}function F(a){return a===36?(n.consume(a),c++,F):c<2&&!l?o(a):(n.exit("mathTextSequence"),p(a))}function p(a){return a===null?o(a):a===36?(h=n.enter("mathTextSequence"),r=0,w(a)):a===32?(n.enter("space"),n.consume(a),n.exit("space"),p):g(a)?(n.enter("lineEnding"),n.consume(a),n.exit("lineEnding"),p):(n.enter("mathTextData"),x(a))}function x(a){return a===null||a===32||a===36||g(a)?(n.exit("mathTextData"),p(a)):(n.consume(a),x)}function w(a){return a===36?(n.consume(a),r++,w):r===c?(n.exit("mathTextSequence"),n.exit("mathText"),m(a)):(h.type="mathTextData",x(a))}}}function O(t){let u=t.length-4,l=3,i,n;if((t[l][1].type==="lineEnding"||t[l][1].type==="space")&&(t[u][1].type==="lineEnding"||t[u][1].type==="space")){for(i=l;++i<u;)if(t[i][1].type==="mathTextData"){t[u][1].type="mathTextPadding",t[l][1].type="mathTextPadding",l+=2,u-=2;break}}for(i=l-1,u++;++i<=u;)n===void 0?i!==u&&t[i][1].type!=="lineEnding"&&(n=i):(i===u||t[i][1].type==="lineEnding")&&(t[n][1].type="mathTextData",i!==n+2&&(t[n][1].end=t[i-1][1].end,t.splice(n+2,i-n-2),u-=i-n-2,i=n+2),n=void 0);return t}function L(t){return t!==36||this.events[this.events.length-1][1].type==="characterEscape"}function _(t){return{flow:{36:v},text:{36:N(t)}}}function A(t,u){const l=String(t);let i=l.indexOf(u),n=i,m=0,o=0;if(typeof u!="string"||u.length!==1)throw new Error("Expected character");for(;i!==-1;)i===n?++m>o&&(o=m):m=1,n=i+1,i=l.indexOf(u,n);return o}function B(){return{enter:{mathFlow:t,mathFlowFenceMeta:u,mathText:m},exit:{mathFlow:n,mathFlowFence:i,mathFlowFenceMeta:l,mathFlowValue:c,mathText:o,mathTextData:c}};function t(r){this.enter({type:"math",meta:null,value:"",data:{hName:"div",hProperties:{className:["math","math-display"]},hChildren:[{type:"text",value:""}]}},r)}function u(){this.buffer()}function l(){const r=this.resume(),h=this.stack[this.stack.length-1];h.meta=r}function i(){this.getData("mathFlowInside")||(this.buffer(),this.setData("mathFlowInside",!0))}function n(r){const h=this.resume().replace(/^(\r?\n|\r)|(\r?\n|\r)$/g,""),s=this.exit(r);s.value=h,s.data.hChildren[0].value=h,this.setData("mathFlowInside")}function m(r){this.enter({type:"inlineMath",value:"",data:{hName:"span",hProperties:{className:["math","math-inline"]},hChildren:[{type:"text",value:""}]}},r),this.buffer()}function o(r){const h=this.resume(),s=this.exit(r);s.value=h,s.data.hChildren[0].value=h}function c(r){this.config.enter.data.call(this,r),this.config.exit.data.call(this,r)}}function V(t){let u=(t||{}).singleDollarTextMath;return u==null&&(u=!0),i.peek=n,{unsafe:[{character:"\r",inConstruct:"mathFlowMeta"},{character:`
`,inConstruct:"mathFlowMeta"},{character:"$",after:u?void 0:"\\$",inConstruct:"phrasing"},{character:"$",inConstruct:"mathFlowMeta"},{atBreak:!0,character:"$",after:"\\$"}],handlers:{math:l,inlineMath:i}};function l(m,o,c,r){const h=m.value||"",s=q(r),F="$".repeat(Math.max(A(h,"$")+1,2)),p=c.enter("mathFlow");let x=s.move(F);if(m.meta){const w=c.enter("mathFlowMeta");x+=s.move(D(c,m.meta,{before:x,after:`
`,encode:["$"],...s.current()})),w()}return x+=s.move(`
`),h&&(x+=s.move(h+`
`)),x+=s.move(F),p(),x}function i(m,o,c){let r=m.value||"",h=1;for(u||h++;new RegExp("(^|[^$])"+"\\$".repeat(h)+"([^$]|$)").test(r);)h++;const s="$".repeat(h);/[^ \r\n]/.test(r)&&(/^[ \r\n]/.test(r)&&/[ \r\n]$/.test(r)||/^\$|\$$/.test(r))&&(r=" "+r+" ");let F=-1;for(;++F<c.unsafe.length;){const p=c.unsafe[F],x=b(p);let w;if(p.atBreak)for(;w=x.exec(r);){let a=w.index;r.codePointAt(a)===10&&r.codePointAt(a-1)===13&&a--,r=r.slice(0,a)+" "+r.slice(w.index+1)}}return s+r+s}function n(){return"$"}}function j(t={}){const u=this.data();l("micromarkExtensions",_(t)),l("fromMarkdownExtensions",B()),l("toMarkdownExtensions",V(t));function l(i,n){(u[i]?u[i]:u[i]=[]).push(n)}}export{j as default};
