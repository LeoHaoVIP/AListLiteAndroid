import{a_ as T,E as t,I as z,q as M,S as g,L as m,ay as F,M as H,F as B,bw as Z,G as E,H as V,K as D,N,C as b,dK as p,ap as y,D as v,ad as x,bW as ee,dL as te,bb as A,dM as ne,_ as re,dN as ae,al as oe,aO as w,aG as $,dO as L,ai as le,o as ce,a1 as ie,aj as ue,V as de,A as R,bv as se,bk as ge,aw as he,O as fe,x as Ce,bd as me}from"./index-BFcje_PK.js";import{o as be,E as W,G as we,H as $e}from"./index-CujSWyj5.js";const j=p(),G=e=>{var o;const[l,a]=b("/"),[c,n]=b(null),d=()=>{n(l())};return(o=e.handle)==null||o.call(e,{setPath:a,startCreateFolder:d}),t(y,{class:"folder-tree-box",w:"$full",overflowX:"auto",get children(){return t(j.Provider,{get value(){var i,r,u,h;return{value:l,onChange:f=>{a(f),e.onChange(f)},autoOpen:(i=e.autoOpen)!=null?i:!1,forceRoot:(r=e.forceRoot)!=null?r:!1,showEmptyIcon:(u=e.showEmptyIcon)!=null?u:!1,showHiddenFolder:(h=e.showHiddenFolder)!=null?h:!0,creatingFolderPath:c,setCreatingFolderPath:n}},get children(){return t(K,{path:"/"})}})}})},K=e=>{const{isHidePath:l}=ee(),[a,c]=b(),{value:n,onChange:d,forceRoot:o,autoOpen:i,showEmptyIcon:r,showHiddenFolder:u,creatingFolderPath:h,setCreatingFolderPath:f}=te(j),U=()=>{var s;return!!(r&&a()!==void 0&&!((s=a())!=null&&s.length))},[X,q]=A(()=>ne(e.path,re(),o));let I=!1;const k=async(s=!1)=>{var P;if(!s&&((P=a())!=null&&P.length))return;const Y=await q();se(Y,Q=>{I=!0,c(Q)},()=>{C()&&S()})},{isOpen:C,onToggle:S}=T(),O=()=>n()===e.path,_=ae(e.path);v(oe(n,async s=>{i&&_(s)&&(C()||S(),I||k())})),v(()=>{h()===e.path&&(C()||S(),I||k())});const J=()=>l(e.path)&&!_(n());return t(g,{get when(){return u||!J()},get children(){return t(y,{get children(){return[t(F,{spacing:"$2",get children(){return[t(g,{get when(){return!X()},get fallback(){return t(L,{size:"sm",get color(){return $()}})},get children(){return t(g,{get when(){return!U()},get fallback(){return t(w,{get color(){return $()},as:W})},get children(){return t(w,{get color(){return $()},as:be,get transform(){return C()?"rotate(90deg)":"none"},transition:"transform 0.2s",cursor:"pointer",onClick:()=>{S(),C()&&k()}})}})}}),t(le,{css:{whiteSpace:"nowrap"},fontSize:"$md",cursor:"pointer",px:"$1",rounded:"$md",get bgColor(){return O()?"$info8":"transparent"},get _hover(){return{bgColor:O()?"$info8":ie()}},onClick:()=>{d(e.path)},get children(){return x(()=>e.path==="/")()?"root":ce(e.path)}})]}}),t(g,{get when(){return C()},get children(){return t(ue,{mt:"$1",pl:"$4",alignItems:"start",spacing:"$1",get children(){return[t(de,{get each(){return a()},children:s=>t(K,{get path(){return R(e.path,s.name)}})}),t(g,{get when(){return h()===e.path},get children(){return t(ke,{get parentPath(){return e.path},onCancel:()=>f(null),onSuccess:s=>{f(null),d(s),k(!0)}})}})]}})}})]}})}})},Fe=0,ke=e=>{const l=M(),[a,c]=b(""),[n,d]=A(ge),o=async()=>{const r=a().trim();if(!r||n())return;const u=fe(r);if(!u.valid){Ce.warning(l("global.".concat(u.error)));return}const h=R(e.parentPath,r),f=await d(h);me(f,()=>{e.onSuccess(h)},()=>{e.onCancel()})};let i;return he(()=>{setTimeout(()=>{i==null||i.focus(),i==null||i.select()},Fe)}),t(F,{spacing:"$2",w:"$full",pl:"$4",alignItems:"center",get children(){return[t(w,{get color(){return $()},as:W}),t(z,{ref:r=>i=r,get value(){return a()},onInput:r=>c(r.currentTarget.value),get placeholder(){return l("home.toolbar.input_dir_name")},size:"sm",flex:"1",onKeyDown:r=>{r.key==="Enter"?(r.preventDefault(),o()):r.key==="Escape"&&e.onCancel()},onBlur:r=>{if(n())return;const u=r.relatedTarget;(u==null?void 0:u.dataset.folderAction)!=="true"&&(a().trim()||e.onCancel())}}),t(g,{get when(){return!n()},get fallback(){return t(L,{size:"sm",get color(){return $()}})},get children(){return t(m,{get"aria-label"(){return l("global.ok")},size:"sm",variant:"ghost",rounded:"$md",p:"$1",color:"$success9",onClick:o,tabIndex:0,"data-folder-action":"true",get children(){return t(w,{as:we,boxSize:"$6"})}})}}),t(m,{get"aria-label"(){return l("global.cancel")},size:"sm",variant:"ghost",rounded:"$md",p:"$1",color:"$danger9",get onClick(){return e.onCancel},tabIndex:0,"data-folder-action":"true",get children(){return t(w,{as:$e,boxSize:"$6"})}})]}})},Ie=e=>{const l=M(),[a,c]=b("/"),[n,d]=b();return v(()=>{var o;e.opened&&((o=n())==null||o.setPath(a()))}),typeof e.defaultValue=="function"?v(()=>{c(e.defaultValue())}):typeof e.defaultValue=="string"&&c(e.defaultValue),t(N,{size:"xl",blockScrollOnMount:!1,get opened(){return e.opened},get onClose(){return e.onClose},get children(){return[t(H,{}),t(B,{get children(){return[t(E,{w:"$full",css:{overflowWrap:"break-word"},get children(){return t(F,{w:"$full",justifyContent:"space-between",alignItems:"center",get children(){return[t(y,{css:{overflowWrap:"break-word"},get children(){return e.header}}),t(g,{get when(){return x(()=>!!e.headerSlot)()&&n()},get children(){return e.headerSlot(n())}})]}})}}),t(V,{get children(){return[x(()=>e.children),t(G,{onChange:c,handle:o=>d(o),autoOpen:!0})]}}),t(D,{display:"flex",w:"$full",gap:"$4",alignItems:"flex-end",justifyContent:"flex-end",get children(){return[t(g,{get when(){return e.footerSlot},get children(){return t(y,{mr:"auto",get children(){return e.footerSlot}})}}),t(F,{spacing:"$2",get children(){return[t(m,{get onClick(){return e.onClose},colorScheme:"neutral",get children(){return l("global.cancel")}}),t(m,{get loading(){return e.loading},onClick:()=>{var o;return(o=e.onSubmit)==null?void 0:o.call(e,a())},get children(){return l("global.ok")}})]}})]}})]}})]}})},xe=e=>{const{isOpen:l,onOpen:a,onClose:c}=T(),n=M();return[t(F,{w:"$full",spacing:"$2",get children(){return[t(z,{get id(){return e.id},get value(){return e.value},onInput:d=>e.onChange(d.currentTarget.value),get readOnly(){return e.onlyFolder},get onClick(){return e.onlyFolder?a:()=>{}},get placeholder(){return n("global.".concat(e.onlyFolder?"choose_folder":"choose_or_input_path"))}}),t(g,{get when(){return!e.onlyFolder},get children(){return t(m,{onClick:a,get children(){return n("global.choose")}})}})]}}),t(N,{size:"xl",get opened(){return l()},onClose:c,get children(){return[t(H,{}),t(B,{get children(){return[t(Z,{}),t(E,{get children(){return n("global.choose_folder")}}),t(V,{get children(){return t(G,{forceRoot:!0,get onChange(){return e.onChange}})}}),t(D,{get children(){return t(m,{onClick:c,get children(){return n("global.confirm")}})}})]}})]}})]};export{G as F,Ie as M,xe as a};
