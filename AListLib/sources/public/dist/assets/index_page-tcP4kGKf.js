import{az as D,dE as G,C as u,bb as d,bs as h,dF as A,dG as J,a_ as Q,E as e,q as E,c2 as x,ay as F,aO as U,aj as N,ai as b,ad as l,cE as k,cR as Y,S as B,a4 as H,L as i,M as ee,F as te,bw as re,G as ne,H as se,T as ae,I as q,K as oe,N as ie,bv as O,bd as g,bG as j,bT as de}from"./index-BFcje_PK.js";import{G as le}from"./index-DZCuhf81.js";import ce from"./Common-Bg8ffi3l.js";import"./useTitle-D5uVo66S.js";import"./index-CujSWyj5.js";import"./index-CrmJXdfg.js";import"./SettingItem-CNVSYbWM.js";import"./item_type-CyD6qwPS.js";import"./ResponsiveGrid-vV_RulBc.js";var ue=D('<svg width=1em height=1em viewBox="0 0 24 24"><g fill=none stroke=currentColor stroke-linecap=round stroke-width=2><path stroke-dasharray=60 stroke-dashoffset=60 stroke-opacity=.3 d="M12 3C16.9706 3 21 7.02944 21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3Z"><animate fill=freeze attributeName=stroke-dashoffset dur=1.3s values=60;0></animate></path><path stroke-dasharray=15 stroke-dashoffset=15 d="M12 3C16.9706 3 21 7.02944 21 12"><animate fill=freeze attributeName=stroke-dashoffset dur=0.3s values=15;0></animate><animateTransform attributeName=transform dur=1.5s repeatCount=indefinite type=rotate values="0 12 12;360 12 12">'),ge=D('<svg width=1em height=1em viewBox="0 0 24 24"><g stroke=currentColor stroke-linecap=round stroke-linejoin=round stroke-width=2><path fill=currentColor fill-opacity=0 stroke-dasharray=60 stroke-dashoffset=60 d="M3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12Z"><animate fill=freeze attributeName=stroke-dashoffset dur=0.5s values=60;0></animate><animate fill=freeze attributeName=fill-opacity begin=0.8s dur=0.15s values=0;0.3></animate></path><path fill=none stroke-dasharray=14 stroke-dashoffset=14 d="M8 12L11 15L16 10"><animate fill=freeze attributeName=stroke-dashoffset begin=0.6s dur=0.2s values=14;0>');function he(r){return(()=>{var s=ue();return G(s,r,!0,!0),s})()}function pe(r){return(()=>{var s=ge();return G(s,r,!0,!0),s})()}const me=()=>{const r=E(),[s,C]=u(),[z,y]=d(()=>h.get("/admin/index/progress")),[p,m]=u(),f=t=>{p()&&clearTimeout(p()),m(t?window.setTimeout(a,5e3):void 0)},a=async()=>{const t=await y();O(t,o=>{C(o),f(!o.is_done)},(o,P)=>{f(P!==404)})};a();const[$,S]=d(A),T=async()=>{const t=await S();g(t),a()},[w,I]=d(()=>h.post("/admin/index/clear")),_=async()=>{const t=await I();g(t),a()},[L,R]=d(()=>h.post("/admin/index/stop")),M=async()=>{const t=await R();g(t),a()};let c,n;const[v,V]=d(J),Z=async()=>{let t=[];c.value&&(t=c.value.split("\n"));let o=20;n.value&&(o=parseInt(n.value));const P=await V(t,o);g(P),a()},{isOpen:K,onOpen:W,onClose:X}=Q();return[e(x,{get children(){return r("indexes.index_header")}}),e(ce,{get group(){return le.INDEX}}),e(x,{get children(){return r("indexes.current")}}),e(B,{get when(){return s()},get children(){return e(F,{spacing:"$2",w:"fit-content",shadow:"$md",rounded:"$lg",get bg(){return H("","$neutral3")()},get children(){return[e(U,{boxSize:"$28",color:"$accent9",p:"$2",get as(){var t;return(t=s())!=null&&t.is_done?pe:he}}),e(N,{spacing:"$2",flex:"1",alignItems:"start",mr:"$2",get children(){return[e(b,{get children(){return[l(()=>r("indexes.obj_count")),":",e(k,{colorScheme:"info",ml:"$2",get children(){var t;return(t=s())==null?void 0:t.obj_count}})]}}),e(b,{get children(){return[l(()=>r("indexes.last_done_time")),":",e(k,{colorScheme:"accent",ml:"$2",get children(){return l(()=>!!s().last_done_time)()?Y(s().last_done_time):r("indexes.unknown")}})]}}),e(B,{get when(){var t;return(t=s())==null?void 0:t.error},get children(){return e(b,{css:{wordBreak:"break-all"},get children(){return[l(()=>r("indexes.error")),":",e(k,{colorScheme:"danger",ml:"$2",get children(){return s().error}})]}})}})]}})]}})}}),e(F,{spacing:"$2",get children(){return[e(i,{colorScheme:"accent",onClick:[a,void 0],get loading(){return z()},get children(){return r("global.refresh")}}),e(i,{colorScheme:"danger",onClick:[_,void 0],get loading(){return w()},get children(){return r("indexes.clear")}}),e(i,{colorScheme:"warning",onClick:[M,void 0],get loading(){return L()},get children(){return r("indexes.stop")}}),e(i,{onClick:[T,void 0],get loading(){return $()},get children(){var t;return r("indexes.".concat((t=s())!=null&&t.is_done?"rebuild":"build"))}})]}}),e(i,{onClick:W,get children(){return r("indexes.update")}}),e(ie,{get opened(){return K()},onClose:X,get children(){return[e(ee,{}),e(te,{get children(){return[e(re,{}),e(ne,{get children(){return r("indexes.update")}}),e(se,{get children(){return[e(x,{get children(){return r("indexes.paths_to_update")}}),e(ae,{ref(t){var o=c;typeof o=="function"?o(t):c=t}}),e(x,{get children(){return r("indexes.max_depth")}}),e(q,{value:20,type:"number",ref(t){var o=n;typeof o=="function"?o(t):n=t}})]}}),e(oe,{get children(){return e(i,{onClick:[Z,void 0],get loading(){return v()},get children(){return r("indexes.update")}})}})]}})]}})]},fe=()=>{const r=E(),[s,C]=u(),[z,y]=d(()=>h.get("/admin/scan/progress")),[p,m]=u(),f=n=>{p()&&clearTimeout(p()),m(n?window.setTimeout(a,5e3):void 0)},a=async()=>{const n=await y();O(n,v=>{C(v),f(!v.is_done)},()=>{f(!0)})};a();const[$,S]=d(()=>h.post("/admin/scan/stop")),T=async()=>{const n=await S();g(n),a()},[w,I]=u("/"),[_,L]=u(0),[R,M]=d(()=>h.post("/admin/scan/start",{path:w(),limit:_()})),c=async()=>{const n=await M();g(n),a()};return[e(x,{get children(){return r("indexes.scan_header")}}),e(B,{get when(){return s()},get children(){return e(N,{alignItems:"start",spacing:"$2",w:"fit-content",p:"$2",shadow:"$md",rounded:"$lg",get bg(){return H("","$neutral3")()},get children(){return[e(b,{get children(){return[l(()=>r("indexes.task_status")),":",e(k,{get colorScheme(){var n;return(n=s())!=null&&n.is_done?"accent":"success"},ml:"$2",get children(){return l(()=>{var n;return!!((n=s())!=null&&n.is_done)})()?r("indexes.idle"):r("indexes.running")}})]}}),e(b,{get children(){return[l(()=>r("indexes.obj_count")),":",e(k,{colorScheme:"info",ml:"$2",get children(){var n;return(n=s())==null?void 0:n.obj_count}})]}}),e(i,{colorScheme:"danger",onClick:T,get loading(){return $()},get disabled(){var n;return(n=s())==null?void 0:n.is_done},get children(){return r("indexes.stop")}})]}})}}),e(de,{w:"100%",display:"flex",flexDirection:"column",get children(){return[e(j,{display:"flex",alignItems:"center",get children(){return r("indexes.path_to_scan")}}),e(q,{get value(){return w()},onInput:n=>I(n.currentTarget.value)}),e(j,{display:"flex",alignItems:"center",get children(){return r("indexes.rate_limit")}}),e(q,{type:"number",get value(){return _()},step:.1,onInput:n=>L(parseFloat(n.currentTarget.value))})]}}),e(i,{colorScheme:"info",onClick:c,get loading(){return R()},get children(){return r("indexes.start")}})]},Se=()=>e(N,{spacing:"$2",w:"$full",alignItems:"start",get children(){return[e(me,{}),e(fe,{})]}});export{Se as default};
