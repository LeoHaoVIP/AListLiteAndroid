System.register(["./index-legacy-DGSy0swL.js","./item_type-legacy-BFH7Oxl9.js","./ResponsiveGrid-legacy-DwKlTvwW.js"],function(e,r){"use strict";var t,n,a,i,d,u,o,g,l,s,c,m,v,h,p,y,f,b,w,$,C,S,_,x,k,O,T,I,j,F,N,B,R,q,D;return{setters:[e=>{t=e.D,n=e.bF,a=e.o,i=e.a9,d=e.aa,u=e.I,o=e.bR,g=e.T,l=e.bG,s=e.bX,c=e.ac,m=e.aS,v=e.S,h=e.H,p=e.bS,y=e.j,f=e.ba,b=e.br,w=e.B,$=e.bW,C=e.P,S=e.c1,_=e.ai,x=e.dI,k=e.df,O=e.dg,T=e.U,I=e.R,j=e.K,F=e.r,N=e.Z,B=e.bu,R=e.ap},e=>{q=e.T},e=>{D=e.R}],execute:function(){const r=e=>{const r=a();return t(p,{w:"$full",display:"flex",flexDirection:"column",get required(){return e.required},get children(){return[t(n,{get for(){return e.name},display:"flex",alignItems:"center",get children(){return r(e.full_name_path??"common"===e.driver?`storages.common.${e.name}`:`drivers.${e.driver}.${e.name}`)}}),t(i,{get fallback(){return t(m,{get children(){return r("settings.unknown_type")}})},get children(){return[t(d,{get when(){return e.type===q.String},get children(){return t(u,{get id(){return e.name},get type(){return"password"==e.name?"password":"text"},get readOnly(){return e.readonly},get value(){return e.value},get onChange(){return e.type===q.String?r=>e.onChange?.(r.currentTarget.value):void 0}})}}),t(d,{get when(){return e.type===q.Number},get children(){return t(u,{type:"number",get id(){return e.name},get readOnly(){return e.readonly},get value(){return e.value},get onInput(){return e.type===q.Number?r=>e.onChange?.(parseInt(r.currentTarget.value)):void 0}})}}),t(d,{get when(){return e.type===q.Float},get children(){return t(u,{type:"number",get id(){return e.name},get readOnly(){return e.readonly},get value(){return e.value},get onInput(){return e.type===q.Float?r=>e.onChange?.(parseFloat(r.currentTarget.value)):void 0}})}}),t(d,{get when(){return e.type===q.Bool},get children(){return t(o,{get id(){return e.name},get readOnly(){return e.readonly},get defaultChecked(){return e.value},get onChange(){return e.type===q.Bool?r=>e.onChange?.(r.currentTarget.checked):void 0}})}}),t(d,{get when(){return e.type===q.Text},get children(){return t(g,{get id(){return e.name},get readOnly(){return e.readonly},get value(){return e.value},get onChange(){return e.type===q.Text?r=>e.onChange?.(r.currentTarget.value):void 0}})}}),t(d,{get when(){return e.type===q.Select},get children(){return t(l,{get id(){return e.name},get readOnly(){return e.readonly},get defaultValue(){return e.value},get onChange(){return e.type===q.Select?r=>e.onChange?.(r):void 0},get children(){return t(s,{get readonly(){return e.readonly},get searchable(){return c(()=>e.type===q.Select)()&&e.searchable},get options(){return e.options.split(",").map(t=>({key:t,label:r((e.options_prefix??("common"===e.driver?`storages.common.${e.name}s`:`drivers.${e.driver}.${e.name}s`))+`.${t}`)}))}})}})}})]}}),t(v,{get when(){return e.help},get children(){return t(h,{get children(){return r("common"===e.driver?`storages.common.${e.name}-tips`:`drivers.${e.driver}.${e.name}-tips`)}})}})]}})};function G(e,r){switch(e){case q.Bool:return!!r&&"true"===r;case q.Number:return r?parseInt(r):0;case q.Float:return r?parseFloat(r):0;default:return r||""}}e("default",()=>{const e=a(),{params:n,back:i,to:d}=y(),{id:u}=n,[o,g]=f(()=>b.get("/admin/driver/list"),!0),[l,s]=w({}),[m,h]=f(()=>b.get(`/admin/storage/get?id=${u}`),!0),[p,J]=f(()=>b.get(`/admin/driver/info?driver=${H.driver}`),!0);u?(async()=>{const e=await h();B(e,async e=>{K(e),U(JSON.parse(e.addition));const r=await J();B(r,e=>s({[H.driver]:e}))})})():(async()=>{const e=await g();B(e,s)})();const[H,K]=$({}),[P,U]=$({}),[V,W]=f(()=>(K("addition",JSON.stringify(P)),b.post("/admin/storage/"+(u?"update":"create"),H))),X=C(()=>{const e=l()[H.driver]?.config.alert;if(console.log(e),e)return e.split("|")[0]});return t(R,{get loading(){return u?m()||p():o()},get children(){return[t(S,{mb:"$2",get children(){return e("global."+(u?"edit":"add"))}}),t(_,{mb:"$2",spacing:"$2",get children(){return[t(r,{name:"driver",default:"",readonly:void 0!==u,required:!0,searchable:!0,get type(){return q.Select},get options(){return u?H.driver:Object.keys(l()).join(",")},get value(){return H.driver},full_name_path:"storages.common.driver",options_prefix:"drivers.drivers",driver:"drivers",onChange:e=>{for(const r of l()[e].common)K(r.name,G(r.type,r.default));U(x(e=>{for(const r in e)delete e[r]}));for(const r of l()[e].additional)U(r.name,G(r.type,r.default));K("driver",e)}}),t(v,{get when(){return X()},get children(){return t(k,{get status(){return X()},w:"$full",get children(){return[t(O,{}),c(()=>e(`drivers.config.${H.driver}.alert`))]}})}})]}}),t(D,{get children(){return t(v,{get when(){return l()[H.driver]},get children(){return[t(T,{get each(){return l()[H.driver].common},children:e=>t(r,I(e,{driver:"common",get value(){return H[e.name]},onChange:r=>{K(e.name,r)}}))}),t(T,{get each(){return l()[H.driver].additional},children:e=>t(r,I(e,{get driver(){return H.driver},get value(){return P[e.name]},onChange:r=>{U(e.name,r)}}))})]}})}}),t(j,{mt:"$2",get loading(){return V()},onClick:async()=>{l()[H.driver].config.need_ms&&(F.info(e("manage.add_storage-tips")),window.open(N("/@manage/messenger"),"_blank"));const r=await W();B(r,()=>{F.success(e("global.save_success")),i()},(e,t)=>{r.data.id&&d(`/@manage/storages/edit/${r.data.id}`)})},get children(){return e("global."+(u?"save":"add"))}})]}})})}}});
